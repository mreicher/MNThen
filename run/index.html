<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RunFlow - Mobile Run Tracker</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }
        
        body {
            background-color: #e5e7eb;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }
        
        /* Main App Container */
        .app-container {
            width: 100%;
            max-width: 500px;
            background-color: white;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        /* Header */
        .header {
            background-color: #3b82f6;
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
        }
        
        .exit-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .exit-btn:active {
            background: rgba(255,255,255,0.3);
            transform: scale(0.95);
        }
        
        .app-title {
            font-size: 32px;
            margin-bottom: 8px;
            font-weight: 900;
            letter-spacing: -1px;
        }
        
        .app-subtitle {
            font-size: 16px;
            opacity: 0.9;
            font-weight: 400;
        }
        
        /* Stats Section */
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            padding: 24px 20px 16px;
            background-color: #ffffff;
        }
        
        .stat-card {
            background-color: #f8fafc;
            border-radius: 20px;
            padding: 20px 16px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }
        
        .stat-label {
            font-size: 14px;
            color: #64748b;
            margin-bottom: 6px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 900;
            color: #1e293b;
            letter-spacing: -1px;
        }
        
        /* Pace Section (full width) */
        .pace-section {
            grid-column: 1 / -1;
            background-color: #f8fafc;
            border-radius: 20px;
            padding: 20px 16px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
            margin-top: 8px;
        }
        
        /* Info Box */
        .info-box {
            background-color: #dbeafe;
            border-radius: 16px;
            padding: 20px;
            margin: 16px 20px 20px;
            text-align: center;
            border: 2px solid #93c5fd;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .info-title {
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 8px;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .info-text {
            color: #374151;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* Controls */
        .controls {
            display: grid;
            gap: 16px;
            padding: 20px;
            background-color: #f1f5f9;
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .control-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }
        
        .control-single {
            grid-column: 1 / -1;
        }
        
        button {
            padding: 18px 12px;
            border: none;
            border-radius: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            min-height: 60px;
        }
        
        button:active {
            transform: scale(0.96);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        #startBtn {
            background-color: #10b981;
            color: white;
        }
        
        #pauseBtn {
            background-color: #f59e0b;
            color: white;
        }
        
        #resumeBtn {
            background-color: #10b981;
            color: white;
            display: none;
        }
        
        #stopBtn {
            background-color: #ef4444;
            color: white;
        }
        
        #resetBtn {
            background-color: #64748b;
            color: white;
        }
        
        #splitsBtn {
            background-color: #3b82f6;
            color: white;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        button:disabled:active {
            transform: none;
        }
        
        /* GPS Status */
        .gps-status {
            padding: 20px;
            background-color: #1e293b;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 600;
        }
        
        /* Ad Space */
        .ad-space {
            padding: 20px;
            background-color: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100px;
            border: 2px dashed #cbd5e1;
            margin: 20px;
            border-radius: 12px;
        }
        
        .ad-placeholder {
            color: #64748b;
            font-size: 14px;
            font-style: italic;
            text-align: center;
        }
        
        /* Splits Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .splits-modal {
            background-color: white;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            background-color: #3b82f6;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .modal-close:active {
            background: rgba(255,255,255,0.3);
            transform: scale(0.95);
        }
        
        .modal-content {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        #splitsList {
            list-style-type: none;
        }
        
        #splitsList li {
            background-color: #f8fafc;
            padding: 18px;
            margin-bottom: 12px;
            border-radius: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
        }
        
        .split-number {
            font-weight: 700;
            color: #3b82f6;
            font-size: 16px;
        }
        
        .split-pace {
            font-weight: 700;
            color: #10b981;
            font-size: 16px;
        }
        
        .no-splits {
            text-align: center;
            color: #64748b;
            font-style: italic;
            padding: 40px 20px;
        }
        
        /* Completion Screen */
        .completion-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .completion-screen.active {
            opacity: 1;
            visibility: visible;
        }
        
        .completion-content {
            background-color: white;
            border-radius: 24px;
            padding: 30px;
            text-align: center;
            max-width: 350px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .completion-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        .completion-title {
            font-size: 28px;
            font-weight: 800;
            color: #10b981;
            margin-bottom: 15px;
        }
        
        .completion-stats {
            margin: 20px 0;
            text-align: left;
        }
        
        .completion-stat {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .completion-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .completion-btn {
            flex: 1;
            padding: 15px;
            border-radius: 12px;
            border: none;
            font-weight: 700;
            cursor: pointer;
        }
        
        .btn-close {
            background-color: #3b82f6;
            color: white;
        }
        
        .btn-new {
            background-color: #10b981;
            color: white;
        }
        
        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 0.5s ease;
        }
        
        /* Mobile Optimizations */
        @media (max-width: 480px) {
            .app-title {
                font-size: 28px;
            }
            
            .stat-value {
                font-size: 24px;
            }
            
            button {
                font-size: 14px;
                padding: 16px 10px;
                min-height: 55px;
            }
            
            .stat-card, .pace-section {
                padding: 16px 12px;
            }
            
            .completion-content {
                padding: 25px 20px;
            }
            
            .completion-buttons {
                flex-direction: column;
            }
            
            .control-row {
                gap: 10px;
            }
        }
        
        /* Landscape orientation adjustments */
        @media (orientation: landscape) and (max-height: 500px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .stats {
                padding: 16px;
            }
        }
        
        /* Focus styles for accessibility */
        button:focus {
            outline: 3px solid rgba(59, 130, 246, 0.5);
        }
    </style>
</head>
<body>
    <!-- Main App -->
    <div class="app-container">
        <div class="header">
            <button class="exit-btn" id="exitBtn">√ó</button>
            <h1 class="app-title">üèÉ‚Äç‚ôÇÔ∏è RunFlow</h1>
            <p class="app-subtitle">Track your runs with GPS precision</p>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">‚è±Ô∏è Time</div>
                <div id="time" class="stat-value">00:00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üìç Distance</div>
                <div id="distance" class="stat-value">0.00 mi</div>
            </div>
            <div class="pace-section">
                <div class="stat-label">‚ö° Pace</div>
                <div id="pace" class="stat-value">--:--</div>
            </div>
        </div>
        
        <div class="info-box">
            <div class="info-title">‚ÑπÔ∏è How to use</div>
            <p class="info-text">Start your run, and the app will automatically track your distance and pace using GPS. View splits by tapping the Splits button.</p>
        </div>
        
        <div class="controls">
            <button id="startBtn" class="control-single">‚ñ∂Ô∏è Start Run</button>
            <div class="control-row">
                <button id="pauseBtn" disabled>‚è∏Ô∏è Pause</button>
                <button id="resumeBtn" disabled>‚ñ∂Ô∏è Resume</button>
                <button id="stopBtn" disabled>‚èπÔ∏è Stop</button>
                <button id="resetBtn">üîÑ Reset</button>
            </div>
            <button id="splitsBtn" class="control-single">üìä View Splits</button>
        </div>
        
        <div class="gps-status" id="gpsStatus">
            <span>üåê Acquiring GPS signal...</span>
        </div>
        
        <!-- Ad Space (shows when ready for new run) -->
        <div class="ad-space" id="adSpace" style="display: none;">
            <div class="ad-placeholder">
                Advertisement Space<br>
                <small>Your ad could be here</small>
            </div>
        </div>
    </div>
    
    <!-- Splits Modal -->
    <div class="modal-overlay" id="splitsModal">
        <div class="splits-modal">
            <div class="modal-header">
                <h3 class="modal-title">üìä Mile Splits</h3>
                <button class="modal-close" id="closeSplitsModal">√ó</button>
            </div>
            <div class="modal-content">
                <ul id="splitsList">
                    <li class="no-splits">No splits recorded yet</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Completion Screen -->
    <div class="completion-screen" id="completionScreen">
        <div class="completion-content">
            <div class="completion-icon">üéâ</div>
            <h2 class="completion-title">Run Completed!</h2>
            
            <div class="completion-stats">
                <div class="completion-stat">
                    <span>Total Time:</span>
                    <span id="completeTime">00:00</span>
                </div>
                <div class="completion-stat">
                    <span>Distance:</span>
                    <span id="completeDistance">0.00 mi</span>
                </div>
                <div class="completion-stat">
                    <span>Average Pace:</span>
                    <span id="completePace">--:--</span>
                </div>
            </div>
            
            <div class="completion-buttons">
                <button class="completion-btn btn-close" id="closeComplete">Close</button>
                <button class="completion-btn btn-new" id="newRun">New Run</button>
            </div>
        </div>
    </div>
    
    <script>
        // App state
        const state = {
            running: false,
            paused: false,
            startTime: 0,
            pausedTime: 0,
            elapsedTime: 0,
            totalDistance: 0,
            lastPosition: null,
            watchId: null,
            splits: [],
            lastSplitDistance: 0
        };
        
        // DOM elements
        const exitBtn = document.getElementById('exitBtn');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resumeBtn = document.getElementById('resumeBtn');
        const stopBtn = document.getElementById('stopBtn');
        const resetBtn = document.getElementById('resetBtn');
        const splitsBtn = document.getElementById('splitsBtn');
        const timeDisplay = document.getElementById('time');
        const distanceDisplay = document.getElementById('distance');
        const paceDisplay = document.getElementById('pace');
        const splitsList = document.getElementById('splitsList');
        const gpsStatus = document.getElementById('gpsStatus');
        const adSpace = document.getElementById('adSpace');
        const splitsModal = document.getElementById('splitsModal');
        const closeSplitsModal = document.getElementById('closeSplitsModal');
        const completionScreen = document.getElementById('completionScreen');
        const closeCompleteBtn = document.getElementById('closeComplete');
        const newRunBtn = document.getElementById('newRun');
        const completeTime = document.getElementById('completeTime');
        const completeDistance = document.getElementById('completeDistance');
        const completePace = document.getElementById('completePace');
        
        // Initialize the app
        function init() {
            // Event listeners
            exitBtn.addEventListener('click', exitApp);
            startBtn.addEventListener('click', startRun);
            pauseBtn.addEventListener('click', pauseRun);
            resumeBtn.addEventListener('click', resumeRun);
            stopBtn.addEventListener('click', stopRun);
            resetBtn.addEventListener('click', resetRun);
            splitsBtn.addEventListener('click', showSplitsModal);
            closeSplitsModal.addEventListener('click', hideSplitsModal);
            closeCompleteBtn.addEventListener('click', closeCompletion);
            newRunBtn.addEventListener('click', newRun);
            
            // Close modal when clicking overlay
            splitsModal.addEventListener('click', function(e) {
                if (e.target === splitsModal) {
                    hideSplitsModal();
                }
            });
            
            // Check if Geolocation is available
            if (!navigator.geolocation) {
                updateGpsStatus('‚ùå Geolocation not supported');
                return;
            }
            
            // Try to get initial position
            navigator.geolocation.getCurrentPosition(
                () => {
                    startBtn.disabled = false;
                    updateGpsStatus('‚úÖ GPS ready - Start your run!');
                    adSpace.style.display = 'flex'; // Show ad space when ready
                },
                () => {
                    updateGpsStatus('‚ùå Enable location services to track runs');
                },
                { timeout: 10000 }
            );
        }
        
        // Exit app function
        function exitApp() {
            if (confirm('Are you sure you want to exit RunFlow?')) {
                if (state.running) {
                    stopRun();
                }
                document.body.innerHTML = '<div style="display:flex; justify-content:center; align-items:center; height:100vh; font-size:24px; color:#3b82f6;">RunFlow Closed</div>';
            }
        }
        
        // Show splits modal
        function showSplitsModal() {
            splitsModal.classList.add('active');
        }
        
        // Hide splits modal
        function hideSplitsModal() {
            splitsModal.classList.remove('active');
        }
        
        // Format time from seconds to mm:ss
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Format pace (seconds per mile) to min:sec per mile
        function formatPace(secondsPerMile) {
            if (!secondsPerMile || secondsPerMile === Infinity) return "--:--";
            const mins = Math.floor(secondsPerMile / 60);
            const secs = Math.floor(secondsPerMile % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Calculate distance between two coordinates using Haversine formula
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Earth radius in meters
            const œÜ1 = lat1 * Math.PI / 180;
            const œÜ2 = lat2 * Math.PI / 180;
            const ŒîœÜ = (lat2 - lat1) * Math.PI / 180;
            const ŒîŒª = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(ŒîœÜ / 2) * Math.sin(ŒîœÜ / 2) +
                    Math.cos(œÜ1) * Math.cos(œÜ2) *
                    Math.sin(ŒîŒª / 2) * Math.sin(ŒîŒª / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c; // Distance in meters
        }
        
        // Convert meters to miles
        function metersToMiles(meters) {
            return meters / 1609.34;
        }
        
        // Update GPS status display
        function updateGpsStatus(message) {
            gpsStatus.innerHTML = message;
            
            // Show/hide ad space based on status
            if (message.includes('Ready to start a new run') || message.includes('GPS ready')) {
                adSpace.style.display = 'flex';
            } else if (state.running) {
                adSpace.style.display = 'none';
            }
        }
        
        // Start the run
        function startRun() {
            if (state.running) return;
            
            state.running = true;
            state.startTime = Date.now() - state.elapsedTime * 1000;
            
            startBtn.disabled = true;
            pauseBtn.disabled = false;
            stopBtn.disabled = false;
            resumeBtn.style.display = 'none';
            pauseBtn.style.display = 'block';
            adSpace.style.display = 'none'; // Hide ad space during run
            
            updateGpsStatus('üéØ Tracking your run...');
            
            // Start tracking position
            state.watchId = navigator.geolocation.watchPosition(
                position => {
                    const { latitude, longitude, accuracy } = position.coords;
                    
                    if (state.lastPosition) {
                        const distance = calculateDistance(
                            state.lastPosition.lat, 
                            state.lastPosition.lng,
                            latitude,
                            longitude
                        );
                        
                        // Only add distance if it's reasonable (filter out GPS jumps)
                        if (distance < 100 && accuracy < 50) {
                            state.totalDistance += distance;
                            
                            // Check for new splits (every full mile)
                            const miles = metersToMiles(state.totalDistance);
                            const currentMile = Math.floor(miles);
                            
                            if (currentMile > state.lastSplitDistance) {
                                recordSplit(currentMile);
                                state.lastSplitDistance = currentMile;
                            }
                            
                            // Add visual feedback
                            distanceDisplay.classList.add('pulse');
                            setTimeout(() => distanceDisplay.classList.remove('pulse'), 500);
                        }
                    }
                    
                    state.lastPosition = { lat: latitude, lng: longitude };
                    updateDisplay();
                },
                error => {
                    let errorMsg;
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg = '‚ùå GPS access denied';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg = '‚ùå GPS signal unavailable';
                            break;
                        case error.TIMEOUT:
                            errorMsg = '‚ùå GPS signal timeout';
                            break;
                        default:
                            errorMsg = '‚ùå Unknown GPS error';
                    }
                    updateGpsStatus(errorMsg);
                },
                { 
                    enableHighAccuracy: true, 
                    timeout: 10000, 
                    maximumAge: 2000 
                }
            );
            
            // Start the timer
            requestAnimationFrame(updateTimer);
        }
        
        // Pause the run
        function pauseRun() {
            if (!state.running || state.paused) return;
            
            state.paused = true;
            state.pausedTime = Date.now();
            navigator.geolocation.clearWatch(state.watchId);
            
            pauseBtn.style.display = 'none';
            resumeBtn.style.display = 'block';
            resumeBtn.disabled = false;
            
            updateGpsStatus('‚è∏ Run paused - Press Resume to continue');
        }
        
        // Resume the run
        function resumeRun() {
            if (!state.running || !state.paused) return;
            
            state.paused = false;
            state.startTime = Date.now() - state.elapsedTime * 1000;
            
            resumeBtn.style.display = 'none';
            pauseBtn.style.display = 'block';
            
            updateGpsStatus('üéØ Resuming run tracking...');
            
            // Resume tracking position
            state.watchId = navigator.geolocation.watchPosition(
                position => {
                    const { latitude, longitude, accuracy } = position.coords;
                    
                    if (state.lastPosition) {
                        const distance = calculateDistance(
                            state.lastPosition.lat, 
                            state.lastPosition.lng,
                            latitude,
                            longitude
                        );
                        
                        if (distance < 100 && accuracy < 50) {
                            state.totalDistance += distance;
                            
                            const miles = metersToMiles(state.totalDistance);
                            const currentMile = Math.floor(miles);
                            
                            if (currentMile > state.lastSplitDistance) {
                                recordSplit(currentMile);
                                state.lastSplitDistance = currentMile;
                            }
                            
                            distanceDisplay.classList.add('pulse');
                            setTimeout(() => distanceDisplay.classList.remove('pulse'), 500);
                        }
                    }
                    
                    state.lastPosition = { lat: latitude, lng: longitude };
                    updateDisplay();
                },
                error => {
                    let errorMsg;
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg = '‚ùå GPS access denied';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg = '‚ùå GPS signal unavailable';
                            break;
                        case error.TIMEOUT:
                            errorMsg = '‚ùå GPS signal timeout';
                            break;
                        default:
                            errorMsg = '‚ùå Unknown GPS error';
                    }
                    updateGpsStatus(errorMsg);
                },
                { 
                    enableHighAccuracy: true, 
                    timeout: 10000, 
                    maximumAge: 2000 
                }
            );
            
            // Resume the timer
            requestAnimationFrame(updateTimer);
        }
        
// Stop the run (complete)
       function stopRun() {
           if (!state.running) return;
           
           state.running = false;
           state.paused = false;
           navigator.geolocation.clearWatch(state.watchId);
           
           // Show completion screen
           showCompletionScreen();
       }
       
       // Reset the run
       function resetRun() {
           state.running = false;
           state.paused = false;
           state.elapsedTime = 0;
           state.totalDistance = 0;
           state.lastPosition = null;
           state.splits = [];
           state.lastSplitDistance = 0;
           
           if (state.watchId) {
               navigator.geolocation.clearWatch(state.watchId);
           }
           
           startBtn.disabled = false;
           pauseBtn.disabled = true;
           stopBtn.disabled = true;
           resumeBtn.style.display = 'none';
           pauseBtn.style.display = 'block';
           
           // Reset displays
           timeDisplay.textContent = '00:00';
           distanceDisplay.textContent = '0.00 mi';
           paceDisplay.textContent = '--:--';
           splitsList.innerHTML = '<li class="no-splits">No splits recorded yet</li>';
           
           updateGpsStatus('Ready to start a new run');
       }
       
       // Show completion screen
       function showCompletionScreen() {
           completeTime.textContent = formatTime(state.elapsedTime);
           completeDistance.textContent = metersToMiles(state.totalDistance).toFixed(2) + ' mi';
           
           const miles = metersToMiles(state.totalDistance);
           if (miles > 0.01) {
               const paceSecPerMile = state.elapsedTime / miles;
               completePace.textContent = formatPace(paceSecPerMile) + ' /mi';
           } else {
               completePace.textContent = '--:--';
           }
           
           completionScreen.classList.add('active');
       }
       
       // Close completion screen
       function closeCompletion() {
           completionScreen.classList.remove('active');
           resetRun();
       }
       
       // Start a new run
       function newRun() {
           completionScreen.classList.remove('active');
           resetRun();
       }
       
       // Update the timer display
       function updateTimer() {
           if (!state.running || state.paused) return;
           
           state.elapsedTime = Math.floor((Date.now() - state.startTime) / 1000);
           updateDisplay();
           requestAnimationFrame(updateTimer);
       }
       
       // Update all displays
       function updateDisplay() {
           // Update time
           timeDisplay.textContent = formatTime(state.elapsedTime);
           
           // Update distance (in miles)
           const miles = metersToMiles(state.totalDistance);
           distanceDisplay.textContent = miles.toFixed(2) + ' mi';
           
           // Update pace (min:sec per mile)
           if (miles > 0.01) {
               const paceSecPerMile = state.elapsedTime / miles;
               paceDisplay.textContent = formatPace(paceSecPerMile) + ' /mi';
           } else {
               paceDisplay.textContent = '--:--';
           }
       }
       
       // Record a split for a completed mile
       function recordSplit(mile) {
           const paceSecPerMile = state.elapsedTime / mile;
           state.splits.push({
               mile: mile,
               pace: paceSecPerMile,
               time: state.elapsedTime
           });
           
           // Update splits list in modal
           if (splitsList.firstChild.classList.contains('no-splits')) {
               splitsList.innerHTML = '';
           }
           
           const li = document.createElement('li');
           li.innerHTML = `
               <span class="split-number">Mile ${mile}</span>
               <span class="split-pace">${formatPace(paceSecPerMile)} /mi</span>
           `;
           splitsList.appendChild(li);
       }
       
       // Initialize the app when the page loads
       window.addEventListener('load', init);
   </script>
</body>
</html>
