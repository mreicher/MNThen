<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minnesota Then | Self-Guided Tours</title>
  <link rel="shortcut icon" type="image/x-icon" href="/images/mnthenfav.ico">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- External Stylesheets -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet" href="https://www.mnthen.com/css/dropdown.css">
  <link rel="stylesheet" href="https://www.mnthen.com/css/mnthen_tour.css">
</head>
<body>
  <!-- Header -->
  <header id="header-placeholder" role="banner"></header>

  <!-- Hero Section -->
  <section class="hero-section" style="margin-top: 75px">
    <div class="hero-content">
      <h1 class="hero-title">Self-Guided History Tours</h1>
      <p class="hero-subtitle">Explore the past on your own self-guided pace.</p>
    </div>
  </section>

  <!-- Main Content -->
  <main class="container py-5">
    <!-- Search Bar -->
    <div class="search-bar mb-5">
      <input type="text" id="search-input" class="form-control" placeholder="Search existing tours..." oninput="searchTours()">
    </div>

    <!-- Tour Cards -->
    <div id="tours-list" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      <!-- Tour cards will dynamically populate here -->
    </div>
  </main>

  <!-- Footer -->
  <footer class="container-fluid p-0">
    <div id="footer-placeholder"></div>
  </footer>
 
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Load header and footer first
  Promise.all([
    fetch('/section/header.html').then(response => response.text()),
    fetch('/section/footer.html').then(response => response.text())
  ])
  .then(([headerData, footerData]) => {
    const headerPlaceholder = document.getElementById('header-placeholder');
    const footerPlaceholder = document.getElementById('footer-placeholder');
    
    if (headerPlaceholder) headerPlaceholder.innerHTML = headerData;
    if (footerPlaceholder) footerPlaceholder.innerHTML = footerData;

    // Initialize after DOM update
    setTimeout(initializeNavigation, 0);
  })
  .catch(error => {
    console.error('Error loading content:', error);
    const headerPlaceholder = document.getElementById('header-placeholder');
    if (headerPlaceholder) {
      headerPlaceholder.innerHTML = '<p>Error loading content. Please refresh the page.</p>';
    }
  });

  // Initialize tours if on tours page
  if (document.getElementById('tours-list')) {
    generateTourCards(tours);
  }
});

// Navigation functionality
function initializeNavigation() {
  const mobileMenuBtn = document.querySelector('.mnthen-mobile-menu');
  const mainNav = document.querySelector('.mnthen-nav');
  const dropdownBtns = document.querySelectorAll('.mnthen-dropdown-btn');
  const dropdownToggle = document.querySelector('.dropdown-toggle');
  const dropdownMenu = document.querySelector('.dropdown-menu');
  const toggleButton = document.querySelector('.toggle-button');
  const navbarLinks = document.querySelector('.navbar-links');

  // Mobile menu and dropdown functionality
  if (mobileMenuBtn && mainNav) {
    // Mobile menu toggle
    mobileMenuBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      this.classList.toggle('active');
      mainNav.classList.toggle('active');
    });

    // Dropdown functionality
    dropdownBtns.forEach(btn => {
      ['click', 'touchstart'].forEach(eventType => {
        btn.addEventListener(eventType, function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          dropdownBtns.forEach(otherBtn => {
            if (otherBtn !== btn) {
              otherBtn.classList.remove('active');
              otherBtn.nextElementSibling?.classList.remove('active');
            }
          });
          
          this.classList.toggle('active');
          const dropdownContent = this.nextElementSibling;
          if (dropdownContent) {
            dropdownContent.classList.toggle('active');
          }
        });
      });
    });
  }

  // Additional dropdown toggle functionality
  if (dropdownToggle && dropdownMenu) {
    dropdownToggle.addEventListener('click', () => {
      dropdownMenu.classList.toggle('show');
    });
  }

  // Toggle button for navbar links
  if (toggleButton && navbarLinks) {
    toggleButton.addEventListener('click', () => {
      navbarLinks.classList.toggle('active');
    });
  }

  // Global click/touch handlers
  ['click', 'touchstart'].forEach(eventType => {
    document.addEventListener(eventType, function(e) {
      const isClickInsideNav = e.target.closest('.mnthen-nav');
      const isClickInsideMenu = e.target.closest('.mnthen-mobile-menu');
      const isClickInsideNavbarLinks = navbarLinks?.contains(e.target);
      const isClickInsideToggleButton = toggleButton?.contains(e.target);
      
      if (!isClickInsideNav && !isClickInsideMenu) {
        mainNav?.classList.remove('active');
        mobileMenuBtn?.classList.remove('active');
        dropdownBtns.forEach(btn => {
          btn.classList.remove('active');
          btn.nextElementSibling?.classList.remove('active');
        });
      }

      if (!e.target.matches('.dropdown-toggle') && !e.target.closest('.dropdown-menu')) {
        dropdownMenu?.classList.remove('show');
      }

      if (!isClickInsideNavbarLinks && !isClickInsideToggleButton && navbarLinks?.classList.contains('active')) {
        navbarLinks.classList.remove('active');
      }
    });
  });

  // Handle window resize
  window.addEventListener('resize', function() {
    if (window.innerWidth > 768) {
      mainNav?.classList.remove('active');
      mobileMenuBtn?.classList.remove('active');
      dropdownBtns.forEach(btn => {
        btn.classList.remove('active');
        btn.nextElementSibling?.classList.remove('active');
      });
    }
  });
}

// Tours data and functionality
const tours = [
  {
    title: "Gangsters",
    description: "<strong>Saint Paul:</strong> Travel back in time to the gritty gangster era. Uncover tales of notorious criminals, corrupt police, kidnappings, robberies, thrilling escapes, and intense clashes with law enforcement.<p>Immerse yourself in a captivating journey through history's shadowy alleys. Embark on an adventure of intrigue and nostalgia, where every corner holds a tale of a bygone era..</p>",
    color: "green",
    link: "tour/gangster/gangster_welcome.html",
    locations: 8
  },
  {
    title: "Hamm's Grounds",
    description: "<strong>Saint Paul:</strong> Embark on a journey near the historic Hamm's Brewery, traveling to Swede Hollow and the former Hamm Mansion grounds. Unearth the legacy of the iconic Hamm's Bear, experience the renowned 1894 brewery tour, and delve into the dramatic William Hamm Jr. kidnapping. <p>Explore the Stroh Brewery's closing story and learn about 'Minnesota 13' whiskey, a part of Prohibition's intriguing past.</p>",
    color: "#FF5733",
    link: "tour/hamm/hamm_welcome.html",
    locations: 7
  },
  {
    title: "Lake Drive",
    description: "<strong>White Bear Lake:</strong> Experience the rich history and natural beauty of Lake Drive. Discover historic homes, ancient burial mounds, and remnants of former cottages and hotels. Immerse yourself in the charm and allure of this scenic route, capturing the essence of a bygone era. Explore and indulge in nostalgia. <p>The tour begins on the walking path in front of the White Bear Lake County Park.</p>",
    color: "purple",
    link: "tour/wbl/lake_drive_welcome.html",
    locations: 0
  },
  {
    title: "Capitol Mall",
    description: "<strong>Saint Paul:</strong> Experience the iconic Capitol grounds, uncover timeless monuments, and immerse yourself in Minnesota's unique and unforgettable heritage. This tour guides you south of the Capitol, providing a remarkable opportunity to explore the lives and legacies of extraordinary individuals who shaped the state's growth.<p>The tour begins on the south steps of the Capitol.</p>",
    color: "#800000",
    link: "tour/capitol/welcome.html",
    locations: 0
  }
];

function generateTourCards(toursToShow) {
  const toursList = document.getElementById("tours-list");
  if (!toursList) return;

  toursList.innerHTML = "";

  if (toursToShow.length === 0) {
    toursList.innerHTML = `<p class="text-center">No tours found. <a href="/tour_page.html?nocache=${new Date().getTime()}">Return to Full Tour Page</a></p>`;
    return;
  }

  toursToShow.forEach(tour => {
    toursList.innerHTML += `
      <div class="col-sm-6 col-md-4">
        <div class="tour-card">
          <h2 style="background-color: ${tour.color};">${tour.title}</h2>
          <p>${tour.description}</p>
          <div class="mt-auto">
            <p><strong>Locations:</strong> ${tour.locations}</p>
            <a href="${tour.link}" class="btn btn-primary mt-3 mx-auto btn-block custom-btn-width">Start Tour</a>
          </div>
        </div>
      </div>
    `;
  });
}

function searchTours() {
  const searchInput = document.getElementById("search-input");
  if (!searchInput) return;
  
  const searchTerm = searchInput.value.toLowerCase();
  const filteredTours = tours.filter(tour =>
    tour.title.toLowerCase().includes(searchTerm) ||
    tour.description.toLowerCase().includes(searchTerm)
  );
  generateTourCards(filteredTours);
}
  </script>
</body>
</html>
