<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Inventory Management App</title>
 <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
 <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
 <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
 <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>
 <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-storage.js"></script>
</head>
<body>
 <div class="container my-5">
   <h1 class="mb-4">Inventory Management App</h1>

   <!-- Login Form -->
   <div id="login-form" class="mb-4">
     <h2>Login</h2>
     <form>
       <div class="form-group">
         <label for="username">Username:</label>
         <input type="text" class="form-control" id="username" required>
       </div>
       <div class="form-group">
         <label for="password">Password:</label>
         <input type="password" class="form-control" id="password" required>
       </div>
       <button type="submit" class="btn btn-primary">Login</button>
     </form>
   </div>

   <!-- Inventory Management -->
   <div id="inventory-management" class="d-none">
     <h2>Inventory Management</h2>

     <!-- Directories -->
     <div class="mb-4">
       <h3>Directories</h3>
       <ul id="directories"></ul>
       <input type="text" class="form-control mb-2" id="new-directory" placeholder="New Directory">
       <button class="btn btn-primary" id="create-directory">Create Directory</button>
     </div>

     <!-- Items -->
     <div>
       <h3>Items</h3>
       <table class="table">
         <thead>
           <tr>
             <th>Image</th>
             <th>Title</th>
             <th>Description</th>
             <th>Quantity</th>
             <th>Actions</th>
           </tr>
         </thead>
         <tbody id="item-list"></tbody>
       </table>
       <button class="btn btn-primary" id="add-item">Add Item</button>
     </div>

     <!-- Add/Edit Item Modal -->
     <div class="modal fade" id="item-modal" tabindex="-1" aria-labelledby="item-modal-label" aria-hidden="true">
       <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content">
           <div class="modal-header">
             <h5 class="modal-title" id="item-modal-label">Add Item</h5>
             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
               <span aria-hidden="true">&times;</span>
             </button>
           </div>
           <div class="modal-body">
             <form id="item-form">
               <div class="form-group">
                 <label for="item-title">Title:</label>
                 <input type="text" class="form-control" id="item-title" required>
               </div>
               <div class="form-group">
                 <label for="item-description">Description:</label>
                 <textarea class="form-control" id="item-description" rows="3" required></textarea>
               </div>
               <div class="form-group">
                 <label for="item-quantity">Quantity:</label>
                 <input type="number" class="form-control" id="item-quantity" required>
               </div>
               <div class="form-group">
                 <label for="item-image">Image:</label>
                 <input type="file" class="form-control-file" id="item-image">
               </div>
               <div class="form-group">
                 <label for="item-directory">Directory:</label>
                 <select class="form-control" id="item-directory" required></select>
               </div>
             </form>
           </div>
           <div class="modal-footer">
             <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
             <button type="button" class="btn btn-primary" id="save-item">Save</button>
           </div>
         </div>
       </div>
     </div>
   </div>

   <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
   <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
   <script>
     // Initialize Firebase
     const firebaseConfig = {
       // Your Firebase configuration details
     };
     firebase.initializeApp(firebaseConfig);

     // Firebase references
     const auth = firebase.auth();
     const firestore = firebase.firestore();
     const storage = firebase.storage();

     // Login functionality
     const loginForm = document.getElementById('login-form');
     const inventoryManagement = document.getElementById('inventory-management');

     loginForm.addEventListener('submit', (e) => {
       e.preventDefault();
       const username = document.getElementById('username').value;
       const password = document.getElementById('password').value;

       auth.signInWithEmailAndPassword(username, password)
         .then(() => {
           loginForm.classList.add('d-none');
           inventoryManagement.classList.remove('d-none');
           loadDirectories();
           loadItems();
         })
         .catch((error) => {
           alert('Login failed: ' + error.message);
         });
     });

     // Directory management
     const directoryList = document.getElementById('directories');
     const newDirectoryInput = document.getElementById('new-directory');
     const createDirectoryButton = document.getElementById('create-directory');

     function loadDirectories() {
       directoryList.innerHTML = '';
       firestore.collection('directories').get()
         .then((querySnapshot) => {
           querySnapshot.forEach((doc) => {
             const directoryName = doc.id;
             const directoryItem = document.createElement('li');
             directoryItem.textContent = directoryName;
             directoryList.appendChild(directoryItem);
           });
         })
         .catch((error) => {
           console.error('Error loading directories:', error);
         });
     }

     createDirectoryButton.addEventListener('click', () => {
       const newDirectory = newDirectoryInput.value.trim();
       if (newDirectory) {
         firestore.collection('directories').doc(newDirectory).set({})
           .then(() => {
             newDirectoryInput.value = '';
             loadDirectories();
           })
           .catch((error) => {
             console.error('Error creating directory:', error);
           });
       }
     });

     // Item management
     const itemList = document.getElementById('item-list');
     const addItemButton = document.getElementById('add-item');
     const itemModal = document.getElementById('item-modal');
     const itemForm = document.getElementById('item-form');
     const itemDirectorySelect = document.getElementById('item-directory');
     let currentItemId = null;

     function loadItems() {
       itemList.innerHTML = '';
       firestore.collection('items').get()
         .then((querySnapshot) => {
           querySnapshot.forEach((doc) => {
             const item = doc.data();
             const itemRow = document.createElement('tr');
             itemRow.innerHTML = `
               <td>
                 <img src="${item.imageUrl}" alt="${item.title}" width="50" height="50">
               </td>
               <td>${item.title}</td>
               <td>${item.description}</td>
               <td>${item.quantity}</td>
               <td>
                 <button class="btn btn-primary btn-sm edit-item" data-id="${doc.id}">Edit</button>
                 <button class="btn btn-danger btn-sm delete-item" data-id="${doc.id}">Delete</button>
               </td>
             `;
             itemList.appendChild(itemRow);
           });

           // Add event listeners for edit and delete buttons
           const editButtons = document.querySelectorAll('.edit-item');
           editButtons.forEach((button) => {
             button.addEventListener('click', () => {
               currentItemId = button.dataset.id;
               fillItemForm(currentItemId);
               $('#item-modal').modal('show');
             });
           });

           const deleteButtons = document.querySelectorAll('.delete-item');
           deleteButtons.forEach((button) => {
             button.addEventListener('click', () => {
               deleteItem(button.dataset.id);
             });
           });
         })
         .catch((error) => {
           console.error('Error loading items:', error);
         });
     }

     function fillItemForm(itemId) {
       firestore.collection('items').doc(itemId).get()
         .then((doc) => {
           const item = doc.data();
           document.getElementById('item-title').value = item.title;
           document.getElementById('item-description').value = item.description;
           document.getElementById('item-quantity').value = item.quantity;
           document.getElementById('item-directory').value = item.directory;
         })
         .catch((error) => {
           console.error('Error loading item:', error);
         });
     }

     function deleteItem(itemId) {
       if (confirm('Are you sure you want to delete this item?')) {
         firestore.collection('items').doc(itemId).delete()
           .then(() => {
             loadItems();
           })
           .catch((error) => {
             console.error('Error deleting item:', error);
           });
       }
     }

     addItemButton.addEventListener('click', () => {
       currentItemId = null;
       itemForm.reset();
       loadDirectories();
       $('#item-modal').modal('show');
     });

     itemForm.addEventListener('submit', (e) => {
       e.preventDefault();
       const title = document.getElementById('item-title').value;
       const description = document.getElementById('item-description').value;
       const quantity = parseInt(document.getElementById('item-quantity').value);
       const image = document.getElementById('item-image').files[0];
       const directory = document.getElementById('item-directory').value;

       if (currentItemId) {
         // Update existing item
         firestore.collection('items').doc(currentItemId).update({
           title,
           description,
           quantity,
           directory
         })
           .then(() => {
             $('#item-modal').modal('hide');
             loadItems();
           })
           .catch((error) => {
             console.error('Error updating item:', error);
           });
       } else {
         // Add new item
         const itemRef = firestore.collection('items').doc();
         itemRef.set({
           title,
           description,
           quantity,
           directory,
           imageUrl: ''
         })
           .then(() => {
             if (image) {
               const storageRef = storage.ref(`items/${itemRef.id}/${image.name}`);
               storageRef.put(image)
                 .then(() => {
                   storageRef.getDownloadURL()
                     .then((url) => {
                       itemRef.update({ imageUrl: url });
                       $('#item-modal').modal('hide');
                       loadItems();
                     })
                     .catch((error) => {
                       console.error('Error uploading image:', error);
                     });
                 })
                 .catch((error) => {
                   console.error('Error uploading image:', error);
                 });
             } else {
               $('#item-modal').modal('hide');
               loadItems();
             }
           })
           .catch((error) => {
             console.error('Error adding item:', error);
           });
       }
     });

     // Load directories for the select element
     firestore.collection('directories').get()
       .then((querySnapshot) => {
         querySnapshot.forEach((doc) => {
           const option = document.createElement('option');
           option.value = doc.id;
           option.textContent = doc.id;
           itemDirectorySelect.appendChild(option);
         });
       })
       .catch((error) => {
         console.error('Error loading directories:', error);
       });
   </script>
 </div>
</body>
</html>
