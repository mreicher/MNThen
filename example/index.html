<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Political Bias Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/compromise@14.10.0/dist/compromise.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sentiment@5.0.2/lib/index.min.js"></script>
    <style>
        .meter {
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            position: relative;
            margin: 10px 0;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }
        .bias-meter { background: linear-gradient(to right, #0d6efd, #adb5bd, #dc3545); }
        .emotional-meter { background: linear-gradient(to right, #198754, #ffc107, #dc3545); }
        .tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            margin: 4px;
            font-size: 0.9rem;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        .highlight { padding: 2px; border-radius: 3px; }
        .highlight-left { background-color: rgba(13, 110, 253, 0.2); }
        .highlight-right { background-color: rgba(220, 53, 69, 0.2); }
        .highlight-loaded { background-color: rgba(255, 193, 7, 0.2); }
        .card { transition: transform 0.2s; margin-bottom: 1rem; }
        .card:hover { transform: translateY(-2px); }
        #factCheck { max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body class="bg-light">
    <div class="container py-4">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card shadow">
                    <div class="card-body">
                        <h2 class="mb-4">Advanced Political Bias Analyzer</h2>
                        <div class="mb-4">
                            <label class="form-label">Enter political text to analyze:</label>
                            <textarea id="textInput" class="form-control" rows="6" placeholder="Paste article or political text here..."></textarea>
                            <button id="analyzeBtn" class="btn btn-primary mt-3">Analyze Text</button>
                        </div>
                        <div id="results" class="d-none">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5>Political Bias Analysis</h5>
                                            <div class="meter">
                                                <div id="biasMeter" class="meter-fill bias-meter"></div>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <span class="small">Left</span>
                                                <span class="small">Center</span>
                                                <span class="small">Right</span>
                                            </div>
                                            <p id="biasScore" class="mt-2 text-center fw-bold"></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5>Emotional Content</h5>
                                            <div class="meter">
                                                <div id="emotionalMeter" class="meter-fill emotional-meter"></div>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <span class="small">Neutral</span>
                                                <span class="small">Moderate</span>
                                                <span class="small">Emotional</span>
                                            </div>
                                            <p id="emotionalScore" class="mt-2 text-center fw-bold"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5>Loaded Language</h5>
                                            <div id="loadedTerms"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5>Key Topics</h5>
                                            <div id="keyTopics"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card mt-3">
                                <div class="card-body">
                                    <h5>Annotated Text</h5>
                                    <div id="annotatedText" class="mt-3"></div>
                                </div>
                            </div>
                            <div class="card mt-3">
                                <div class="card-body">
                                    <h5>Fact Check</h5>
                                    <div id="factCheck" class="mt-3"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    class BiasAnalyzer {
        constructor() {
            this.biasTerms = {
                left: {
                    strong: new Set(['socialist', 'progressive', 'leftist', 'radical', 'marxist', 'workers rights', 'universal healthcare', 'wealth tax', 'democratic socialist', 'redistribution', 'equity', 'systemic', 'structural', 'social justice']),
                    moderate: new Set(['liberal', 'regulation', 'welfare', 'unions', 'reform', 'public option', 'climate action', 'gun control', 'immigration reform', 'planned parenthood', 'environmental protection', 'social programs'])
                },
                right: {
                    strong: new Set(['nationalist', 'populist', 'america first', 'maga', 'patriot', 'deep state', 'border wall', 'pro-life', 'religious freedom', 'radical left', 'socialist agenda', 'constitutional conservative']),
                    moderate: new Set(['conservative', 'traditional', 'free market', 'small government', 'tax cuts', 'deregulation', 'private sector', 'law and order', 'fiscal responsibility', 'family values', 'school choice'])
                }
            };
            this.loadedLanguage = {
                strong: new Set(['radical', 'extreme', 'dangerous', 'threatening', 'disaster', 'crisis', 'destructive', 'devastating', 'catastrophic', 'outrageous', 'assault on', 'war on', 'destruction of', 'attack on', 'threat to']),
                moderate: new Set(['biased', 'unfair', 'misleading', 'questionable', 'concerning', 'problematic', 'controversial', 'divisive', 'agenda', 'scheme'])
            };
            this.emotionalLanguage = {
                strong: new Set(['outrageous', 'furious', 'devastating', 'terrible', 'horrible', 'extraordinary', 'incredible', 'amazing', 'outraged', 'disgusting', 'shocking', 'appalling', 'despicable', 'evil', 'corrupt']),
                moderate: new Set(['concerned', 'worried', 'upset', 'pleased', 'happy', 'sad', 'angry', 'frustrated', 'disappointed', 'satisfied', 'troubled', 'disturbed', 'encouraged', 'optimistic'])
            };
        }

        analyze(text) {
            const words = text.toLowerCase().split(/\s+/);
            const phrases = this.extractPhrases(text.toLowerCase());
            let biasScore = 50;
            let leftCount = 0;
            let rightCount = 0;

            phrases.forEach(phrase => {
                if (this.biasTerms.left.strong.has(phrase)) leftCount += 3;
                if (this.biasTerms.left.moderate.has(phrase)) leftCount += 1;
                if (this.biasTerms.right.strong.has(phrase)) rightCount += 3;
                if (this.biasTerms.right.moderate.has(phrase)) rightCount += 1;
            });

            const totalBiasTerms = leftCount + rightCount;
            if (totalBiasTerms > 0) {
                const biasDirection = rightCount - leftCount;
                biasScore = 50 + (biasDirection / totalBiasTerms) * 50;
            }

            let emotionalScore = 50;
            let emotionalCount = 0;
            
            phrases.forEach(phrase => {
                if (this.emotionalLanguage.strong.has(phrase)) emotionalCount += 3;
                if (this.emotionalLanguage.moderate.has(phrase)) emotionalCount += 1;
            });

            const normalizedEmotionalScore = Math.min(100, 50 + (emotionalCount / words.length) * 200);

            const loadedTerms = phrases.filter(phrase => 
                this.loadedLanguage.strong.has(phrase) || 
                this.loadedLanguage.moderate.has(phrase)
            );

            const topics = this.extractTopics(words);
            const annotated = this.annotateText(text);

            return {
                bias: {
                    score: Math.max(0, Math.min(100, biasScore)),
                    label: this.getBiasLabel(biasScore),
                    leftCount,
                    rightCount
                },
                emotional: {
                    score: normalizedEmotionalScore,
                    label: this.getEmotionalLabel(normalizedEmotionalScore)
                },
                loaded: loadedTerms,
                topics: topics,
                annotated: annotated
            };
        }

        extractPhrases(text) {
            const phrases = new Set();
            text.split(/\s+/).forEach(word => phrases.add(word));
            const words = text.split(/\s+/);
            for (let i = 0; i < words.length - 1; i++) {
                phrases.add(words[i] + ' ' + words[i + 1]);
                if (i < words.length - 2) {
                    phrases.add(words[i] + ' ' + words[i + 1] + ' ' + words[i + 2]);
                }
            }
            return phrases;
        }

        extractTopics(words) {
            const stopWords = new Set(['the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by']);
            const topicFrequency = new Map();
            
            words.forEach(word => {
                if (!stopWords.has(word) && word.length > 3) {
                    topicFrequency.set(word, (topicFrequency.get(word) || 0) + 1);
                }
            });

            return Array.from(topicFrequency.entries())
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([text, count]) => ({ text, count }));
        }

        annotateText(text) {
            const words = text.split(/\b/);
            return words.map(word => {
                const lower = word.toLowerCase();
                if (this.biasTerms.left.strong.has(lower) || this.biasTerms.left.moderate.has(lower)) {
                    return `<span class="highlight highlight-left">${word}</span>`;
                }
                if (this.biasTerms.right.strong.has(lower) || this.biasTerms.right.moderate.has(lower)) {
                    return `<span class="highlight highlight-right">${word}</span>`;
                }
                if (this.loadedLanguage.strong.has(lower) || this.loadedLanguage.moderate.has(lower)) {
                    return `<span class="highlight highlight-loaded">${word}</span>`;
                }
                return word;
            }).join('');
        }

        getBiasLabel(score) {
            if (score < 35) return 'Strong Left Bias';
            if (score < 45) return 'Moderate Left Bias';
            if (score <= 55) return 'Relatively Neutral';
            if (score <= 65) return 'Moderate Right Bias';
            return 'Strong Right Bias';
        }

        getEmotionalLabel(score) {
            if (score < 35) return 'Very Neutral';
            if (score < 55) return 'Slightly Emotional';
            if (score < 75) return 'Moderately Emotional';
            return 'Highly Emotional';
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const analyzer = new BiasAnalyzer();
        const analyzeBtn = document.getElementById('analyzeBtn');
        const results = document.getElementById('results');

        analyzeBtn.addEventListener('click', async () => {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                alert('Please enter some text to analyze');
                return;
            }

            const analysis = analyzer.analyze(text);
            updateUI(analysis);
            results.classList.remove('d-none');

            // Perform fact-checking
            await performFactCheck(text);
        });

        function updateUI(analysis) {
            document.getElementById('biasMeter').style.width = `${analysis.bias.score}%`;
            document.getElementById('biasScore').textContent = analysis.bias.label;
            document.getElementById('emotionalMeter').style.width = `${analysis.emotional.score}%`;
            document.getElementById('emotionalScore').textContent = analysis.emotional.label;
            document.getElementById('loadedTerms').innerHTML = analysis.loaded
                .map(term => `<span class="tag">${term}</span>`)
                .join('');
            document.getElementById('keyTopics').innerHTML = analysis.topics
                .map(topic => `<span class="tag">${topic.text} (${topic.count})</span>`)
                .join('');
            document.getElementById('annotatedText').innerHTML = analysis.annotated;
        }

        async function performFactCheck(text) {
            const factCheckDiv = document.getElementById('factCheck');
            factCheckDiv.innerHTML = '<p>Performing fact check...</p>';

            try {
                // Using the free FactCheckTools API
                const response = await fetch(`https://factchecktools.googleapis.com/v1alpha1/claims:search?query=${encodeURIComponent(text)}&key=AIzaSyAO_FJ2SlqU8Q4STEHLGCilw_Y9_11qcW8`);
                const data = await response.json();

                if (data.claims && data.claims.length > 0) {
                    let factCheckHtml = '<ul class="list-group">';
                    data.claims.forEach(claim => {
                        factCheckHtml += `
                            <li class="list-group-item">
                                <strong>Claim:</strong> ${claim.text}<br>
                                <strong>Rating:</strong> ${claim.claimReview[0].textualRating}<br>
                                <a href="${claim.claimReview[0].url}" target="_blank" class="btn btn-sm btn-info mt-2">Read Full Fact Check</a>
                            </li>
                        `;
                    });
                    factCheckHtml += '</ul>';
                    factCheckDiv.innerHTML = factCheckHtml;
                } else {
                    factCheckDiv.innerHTML = '<p>No specific claims found for fact-checking in this text.</p>';
                }
            } catch (error) {
                console.error('Error during fact-checking:', error);
                factCheckDiv.innerHTML = '<p>Error occurred during fact-checking. Please try again later.</p>';
            }
        }
    });
    </script>
</body>
</html>
