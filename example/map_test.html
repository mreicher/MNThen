<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Minnesota Then History Tours</title>
  <link rel="shortcut icon" type="image/jpg" href="/images/mnthenfav.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
  <style>
    .map-container {
      height: 450px; /* Set a fixed height for the map container */
      margin-bottom: 10px; /* Add margin at the bottom to create space for the content */
    }

    #map {
      width: 100%;
      height: 450px;
    }

    .message-box {
      padding: 10px;
      margin-bottom: 20px;
    }

    .safety-message-box {
      padding: 16px;
    }

    body {
      font-size: 18px;
    }

    @media (max-width: 768px) {
      body {
        font-size: 16px;
      }
    }

    .leaflet-popup-content-wrapper:before {
      content: attr(data-number);
      background-color: #0089e0;
      color: #fff;
      font-weight: bold;
      padding: 4px 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 4px;
    }

    .leaflet-popup-content {
      font-size: 18px;
    }

    .leaflet-popup-tip-container {
      display: none;
    }
  </style>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="locations.js"></script> 
  
</head>
<body style="margin: 0; padding: 0;">
  <div id="map" class="map-container"></div>
    
  <div class="container-fluid">
    <div class="row">
      <div class="col-12 text-center">
        <button id="returnButton" class="btn btn-lg btn-secondary">Exit the Tour</button>
        <p></p>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <div class="message-box bg-primary text-white p-3 rounded mb-3" style="font-size: 1.2rem;">
          <p><strong>Navigation Tip:</strong> Discover historical locations by moving toward the map's blue markers. Your mobile device will automatically update with information when you're in range.</p>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <div class="safety-message-box bg-danger text-white p-3 rounded" style="font-size: 1.2rem;">
          <p><strong>Safety Reminder:</strong> We want you to have a safe and enjoyable experience while exploring local history. Please keep an eye on your surroundings and be mindful of potential hazards.</p>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Event listener for the return button
    document.getElementById('returnButton').addEventListener('click', function() {
      window.location.href = 'tour_page.html';
    });

    var map = L.map('map', {
      attributionControl: false // Disable the default attribution control
    }).setView([44.962472993853055, -93.07146893327669], 18);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 20,
      id: 'mapbox/streets-v11',
      tileSize: 512,
      zoomOffset: -1
    }).addTo(map);

    // Add custom attribution control without the logo
    L.control.attribution({
      prefix: false // Remove the default prefix
    }).addTo(map);

    for (var i = 0; i < locations.length; i++) {
      var marker = L.marker([locations[i].lat, locations[i].lng])
        .bindPopup("<b>" + "" + " " + locations[i].name + "</b>")
        .addTo(map);
    }

    var userLocationMarker = L.circleMarker([0, 0], {
      color: 'red',
      fillColor: '#f03',
      fillOpacity: 0.5,
      radius: 10
    }).addTo(map);

    var isUpdatingLocation = false;
    var updateInterval = 2000; // Set the update interval to 2 seconds

    function updateUserLocation(e) {
      if (isUpdatingLocation) return;

      isUpdatingLocation = true;
      setTimeout(function() {
        isUpdatingLocation = false;
      }, updateInterval);

      var feetToMeters = 0.3048; // Conversion factor from feet to meters
      var thresholdFeet = 7; // Threshold distance in feet (range distance)
      var thresholdMeters = thresholdFeet * feetToMeters;

      for (var i = 0; i < locations.length; i++) {
        var distance = e.latlng.distanceTo(L.latLng(locations[i].lat, locations[i].lng));
        if (distance <= thresholdMeters) {
          setTimeout(function() {
            window.location.href = `${locations[i].name}.html`;
          }, 2000); // Two-second delay before transitioning
          return;
        }
      }
    }

    function onLocationFound(e) {
      updateUserLocation(e);
      userLocationMarker.setLatLng(e.latlng);
      map.setView(e.latlng);
    }

    function onLocationError(e) {
      alert(e.message);
    }

    map.on('locationfound', onLocationFound);
    map.on('locationerror', onLocationError);

    map.locate({ setView: true, maxZoom: 18, watch: true });
  </script>
</body>
</html>
