<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Augmented Reality with A-Frame</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        #arScene {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h1 class="text-center mt-4">Dynamic AR Example</h1>
        <p class="text-center">Point your device camera at the markers to see the 3D objects.</p>
    </div>
    <a-scene id="arScene" embedded arjs>
        <!-- AR Marker for Dynamic 3D Object -->
        <a-marker id="dynamicMarker">
            <!-- This marker will be dynamically replaced with a 3D object -->
        </a-marker>

        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>

    <!-- A-Frame Library -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <!-- AR.js Library -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script>
        const dynamicMarker = document.getElementById('dynamicMarker');
        let userLocation = null;

        document.addEventListener('DOMContentLoaded', () => {
            // Start watching the user's position
            startWatchingPosition();
        });

        function startWatchingPosition() {
            if (navigator.geolocation) {
                // Watch the user's position continuously
                navigator.geolocation.watchPosition(
                    position => {
                        userLocation = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        };

                        // Add or update the dynamic 3D object based on user location
                        addOrUpdateDynamicObject();
                    },
                    error => {
                        console.error('Error getting the user\'s position:', error);
                    }
                );
            } else {
                console.error('Geolocation is not supported by this browser.');
            }
        }

        function addOrUpdateDynamicObject() {
            // Check if user location is available
            if (userLocation) {
                // Define your predetermined GPS coordinates for the dynamic 3D object
                const predeterminedLatitude = 45.14438389647825;
                const predeterminedLongitude = -93.00431713415057;

                // Calculate the distance between user location and predetermined coordinates
                const distance = calculateDistance(userLocation, {
                    latitude: predeterminedLatitude,
                    longitude: predeterminedLongitude
                });

                // Define a threshold distance (in meters) for showing the dynamic 3D object
                const thresholdDistance = 100;

                if (distance < thresholdDistance) {
                    // Add the 3D object if it's within the threshold distance
                    addDynamicObject();
                } else {
                    // Remove the 3D object if it's beyond the threshold distance
                    removeDynamicObject();
                }
            }
        }

        function addDynamicObject() {
            // Define the 3D model path (replace with your own model)
            const modelPath = 'path/to/your/model.gltf';

            // Create the dynamic 3D object entity
            const dynamicObject = document.createElement('a-entity');
            dynamicObject.setAttribute('gltf-model', modelPath);
            dynamicObject.setAttribute('scale', '1 1 1');

            // Set the dynamic object's GPS coordinates (replace with your predetermined GPS coordinates)
            dynamicObject.setAttribute('gps-entity-place', 'latitude: 45.14438389647825; longitude: -93.00431713415057;');

            // Append the dynamic object to the dynamicMarker
            dynamicMarker.appendChild(dynamicObject);
        }

        function removeDynamicObject() {
            // Remove all child elements (i.e., 3D objects) from the dynamicMarker
            dynamicMarker.innerHTML = '';
        }

        function calculateDistance(location1, location2) {
            // Implement the Haversine formula to calculate the distance between two GPS coordinates
            // For simplicity, I'll use a dummy distance calculation function here
            const lat1 = location1.latitude;
            const lon1 = location1.longitude;
            const lat2 = location2.latitude;
            const lon2 = location2.longitude;

            const p = 0.017453292519943295; // Math.PI / 180
            const c = Math.cos;
            const a = 0.5 - c((lat2 - lat1) * p) / 2 +
                c(lat1 * p) * c(lat2 * p) *
                (1 - c((lon2 - lon1) * p)) / 2;
            const distance = 12742 * Math.asin(Math.sqrt(a)); // 2 * R; R = 6371 km

            return distance * 1000; // Convert to meters
        }
    </script>
</body>
</html>
