<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minnesota Then | Community Stories</title>

    <link rel="shortcut icon" type="image/x-icon" href="https://www.mnthen.com/images/mnthenfav.ico">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://www.mnthen.com/css/new_header.css">
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f39c12;
            --background-color: #f4f4f4;
            --text-color: #333;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .hero {
            background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1594717527389-a590b56e8d0a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            text-align: center;
            padding: 150px 0;
            position: relative;
        }

        .hero-content {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 30px;
            border-radius: 10px;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        #map {
            height: 400px;
            width: 100%;
            margin-bottom: 20px;
        }

        .moment-form {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .moment-list {
            margin-top: 20px;
        }

        .moment-item {
            background-color: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- Header section -->
    <header>
        <nav class="navbar">
            <div class="navbar-brand">
                <a href="/index.html">Minnesota Then</a>
            </div>
            <a href="#" class="toggle-button">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </a>
            <div class="navbar-links">
                <ul>
                    <li><a href="/blog.html" class="px-1">Blog</a></li>
                    <li><a href="/faq.html" class="px-1">Help Center</a></li>
                    <li class="dropdown">
                        <a href="#" class="px-1 dropdown-toggle">Sponsor Us</a>
                        <div class="dropdown-menu">
                            <div class="container">
                                <a href="/donate.html" class="dropdown-item">
                                    <h5>Make a Donation</h5>
                                </a>
                                <hr class="centered-hr">
                                <a href="#" class="dropdown-item">
                                    <h5>Join our Patreon</h5>
                                </a>
                                <hr class="centered-hr">
                                <a href="#" class="dropdown-item">
                                    <h5>Shop our Online Store</h5>
                                </a>
                            </div>
                        </div>
                    </li>
                    <li><a href="/upcoming_events.html" class="px-1">Upcoming Events</a></li>
                    <li><a href="#" class="donate-btn rounded-pill px-3" id="account-link">
                        <i class="fas fa-user"></i>
                        <span>Log In <span>|</span> Register</span>
                    </a></li>
                </ul>
            </div>
        </nav>
    </header>

    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h1>Minnesota Then</h1>
                <p class="lead">Mark your historic moments on the map</p>
            </div>
        </div>
    </section>

    <div class="container mt-5">
        <div class="row">
            <div class="col-md-8">
                <div id="map"></div>
            </div>
            <div class="col-md-4">
                <form class="moment-form" id="moment-form">
                    <h3>Add Your Historic Moment</h3>
                    <div class="mb-3">
                        <label for="moment-text" class="form-label">Describe your historic moment:</label>
                        <textarea class="form-control" id="moment-text" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Moment</button>
                </form>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-12">
                <h3>Saved Historic Moments</h3>
                <div id="moment-list" class="moment-list"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        let map;
        let marker;
        let moments = [];

        document.addEventListener('DOMContentLoaded', () => {
            initMap();
            loadMoments();
            setupEventListeners();
        });

        function initMap() {
            map = L.map('map').setView([46.7296, -94.6859], 6);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);

            map.on('click', (e) => {
                if (marker) {
                    map.removeLayer(marker);
                }
                marker = L.marker(e.latlng).addTo(map);
            });
        }

        function setupEventListeners() {
            document.getElementById('moment-form').addEventListener('submit', handleAddMoment);
        }

        function handleAddMoment(e) {
            e.preventDefault();
            const momentText = document.getElementById('moment-text').value;
            if (marker && momentText) {
                const newMoment = {
                    position: marker.getLatLng(),
                    text: momentText,
                    timestamp: new Date().toISOString()
                };
                moments.push(newMoment);
                saveMoments();
                renderMoments();
                document.getElementById('moment-form').reset();
                map.removeLayer(marker);
                marker = null;
            } else {
                alert('Please mark a location on the map and enter a description.');
            }
        }

        function saveMoments() {
            localStorage.setItem('historicMoments', JSON.stringify(moments));
        }

        function loadMoments() {
            const savedMoments = localStorage.getItem('historicMoments');
            if (savedMoments) {
                moments = JSON.parse(savedMoments);
                renderMoments();
            }
        }

        function renderMoments() {
            const momentList = document.getElementById('moment-list');
            momentList.innerHTML = '';
            moments.forEach((moment, index) => {
                const momentElement = document.createElement('div');
                momentElement.className = 'moment-item';
                momentElement.innerHTML = `
                    <p><strong>Location:</strong> ${moment.position.lat.toFixed(4)}, ${moment.position.lng.toFixed(4)}</p>
                    <p>${moment.text}</p>
                    <small>Added on: ${new Date(moment.timestamp).toLocaleString()}</small>
                    <button class="btn btn-sm btn-danger float-end" onclick="deleteMoment(${index})">Delete</button>
                `;
                momentList.appendChild(momentElement);

                L.marker([moment.position.lat, moment.position.lng])
                    .addTo(map)
                    .bindPopup(moment.text);
            });
        }

        function deleteMoment(index) {
            moments.splice(index, 1);
            saveMoments();
            renderMoments();
        }
    </script>
</body>
</html>
