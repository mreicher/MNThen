<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minnesota Heritage Markers | Preserving Our Shared History</title>
    <meta name="description" content="Explore and contribute to Minnesota's rich historical tapestry through our interactive map of community heritage markers.">
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #ecf0f1;
            --accent-color: #e67e22;
            --text-color: #333333;
        }

        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Libre Baskerville', serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        header {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            padding: 1rem;
            text-align: center;
        }

        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
        }

        nav ul {
            list-style-type: none;
            padding: 0;
        }

        nav ul li {
            display: inline;
            margin: 0 10px;
        }

        nav ul li a {
            color: var(--secondary-color);
            text-decoration: none;
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        #map-container {
            height: 600px;
            margin-bottom: 2rem;
        }

        #map-controls {
            margin-bottom: 1rem;
        }

        input, select, button {
            margin: 0.5rem;
            padding: 0.5rem;
        }

        button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            opacity: 0.9;
        }

        footer {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            text-align: center;
            padding: 1rem;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>Minnesota Heritage Markers</h1>
        <nav>
            <ul>
                <li><a href="#map">Explore Map</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contribute">Contribute</a></li>
                <li><a href="#resources">Educational Resources</a></li>
                <li><a href="#events">Community Events</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="map">
            <h2>Explore Minnesota's Historical Markers</h2>
            <div id="map-controls">
                <input type="text" id="location-search" placeholder="Search by location">
                <select id="category-filter">
                    <option value="">All Categories</option>
                    <option value="indigenous">Indigenous History</option>
                    <option value="settler">Settler History</option>
                    <option value="industrial">Industrial Heritage</option>
                </select>
                <input type="date" id="date-filter">
            </div>
            <div id="map-container"></div>
        </section>

        <section id="about">
            <h2>About Minnesota Heritage Markers</h2>
            <p>Minnesota Heritage Markers is a collaborative project dedicated to preserving and sharing the rich history of our state. In partnership with local historical societies, academic institutions, and community members, we aim to create a comprehensive digital archive of historical sites and stories across Minnesota.</p>
            <p>Our mission is to make local history accessible to all, fostering a deeper understanding and appreciation of the diverse narratives that shape our shared heritage.</p>
        </section>

        <section id="contribute">
            <h2>Contribute to Our Shared History</h2>
            <p>Have a story to share or a historical site to document? We welcome contributions from community members. All submissions are reviewed by our team of historians to ensure accuracy and relevance.</p>
            <button id="open-contribution-form">Share Your History</button>
        </section>

        <section id="resources">
            <h2>Educational Resources</h2>
            <ul>
                <li><a href="#">Lesson Plans for Educators</a></li>
                <li><a href="#">Historical Research Guides</a></li>
                <li><a href="#">Oral History Collection Tips</a></li>
            </ul>
        </section>

        <section id="events">
            <h2>Upcoming Community Events</h2>
            <div id="events-calendar"></div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Minnesota Heritage Markers. All rights reserved.</p>
        <p>In partnership with the Minnesota Historical Society and the University of Minnesota Department of History.</p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        // Initialize Leaflet map
        const map = L.map('map-container').setView([46.7296, -94.6859], 7);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_FIREBASE_API_KEY",
            authDomain: "YOUR_FIREBASE_AUTH_DOMAIN",
            projectId: "YOUR_FIREBASE_PROJECT_ID",
            storageBucket: "YOUR_FIREBASE_STORAGE_BUCKET",
            messagingSenderId: "YOUR_FIREBASE_MESSAGING_SENDER_ID",
            appId: "YOUR_FIREBASE_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Custom icon
        const customIcon = L.icon({
            iconUrl: 'https://cdn0.iconfinder.com/data/icons/small-n-flat/24/678111-map-marker-512.png',
            iconSize: [32, 32],
            iconAnchor: [16, 32],
            popupAnchor: [0, -32]
        });

        // Marker cluster group
        const markers = L.markerClusterGroup();

        // Load pins
        function loadPins() {
            markers.clearLayers();
            db.collection('pins').get().then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    const pin = doc.data();
                    const marker = L.marker([pin.location.latitude, pin.location.longitude], {icon: customIcon});
                    marker.bindPopup(`<h3>${pin.title}</h3><p>${pin.description}</p><p>Date: ${pin.date}</p>`);
                    markers.addLayer(marker);
                });
                map.addLayer(markers);
            }).catch(error => console.error('Error loading pins: ', error));
        }

        // Initial load of pins
        loadPins();

        // Search functionality
        document.getElementById('location-search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            markers.eachLayer((layer) => {
                const title = layer.getPopup().getContent().toLowerCase();
                if (title.includes(searchTerm)) {
                    layer.setOpacity(1);
                } else {
                    layer.setOpacity(0.3);
                }
            });
        });

        // Category filter
        document.getElementById('category-filter').addEventListener('change', (e) => {
            const category = e.target.value;
            markers.eachLayer((layer) => {
                const pinData = layer.getPopup().getContent();
                if (category === '' || pinData.includes(category)) {
                    layer.setOpacity(1);
                } else {
                    layer.setOpacity(0.3);
                }
            });
        });

        // Date filter
        document.getElementById('date-filter').addEventListener('change', (e) => {
            const selectedDate = new Date(e.target.value);
            markers.eachLayer((layer) => {
                const pinData = layer.getPopup().getContent();
                const pinDate = new Date(pinData.split('Date: ')[1]);
                if (pinDate >= selectedDate) {
                    layer.setOpacity(1);
                } else {
                    layer.setOpacity(0.3);
                }
            });
        });

        // Contribution form
        document.getElementById('open-contribution-form').addEventListener('click', () => {
            alert('Contribution form will be implemented here');
        });

        // Events calendar (placeholder)
        document.getElementById('events-calendar').innerHTML = '<p>Events calendar will be implemented here</p>';
    </script>
</body>
</html>
