<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="Minnesota, history, walking tours, interactive, landmarks, neighborhoods">
  <title>Minnesota Then | Search Results</title>
  <link rel="shortcut icon" type="image/jpg" href="https://www.mnthen.com/images/mnthenfav.ico">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
      <link rel="stylesheet" href="https://www.mnthen.com/css/index.css">
                <link rel="stylesheet" href="/css/search_results.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
   <style>
         .toggle-button .bar {
        background-color: #fff; /* White color for mobile devices */
      }
    }
   </style>
</head>
<body>
  <!-- Header -->
  <div id="header-placeholder"></div>
  
  <!-- search bar -->
  
<div class="search-bar" style="margin-top: 80px">
    <form action="results.html" method="get">
        <input type="search" name="query" placeholder="Search blog articles...">
        <button type="submit">Search</button>
    </form>
</div>

    <!-- Search Summary -->
    <div id="search-summary" class="search-summary"></div>
    
        <!-- search results -->
    <div id="search-results"></div>
    
        <!-- Load Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>

<script>
const dropdownToggle = document.querySelector('.dropdown-toggle');
const dropdownMenu = document.querySelector('.dropdown-menu');

dropdownToggle.addEventListener('click', function() {
  dropdownMenu.classList.toggle('show');
});

// Add event listener to the entire document
document.addEventListener('click', function(event) {
  // Check if the clicked element is not the dropdown toggle or a child of the dropdown menu
  if (!event.target.matches('.dropdown-toggle') && !event.target.closest('.dropdown-menu')) {
    // If not, close the dropdown menu
    dropdownMenu.classList.remove('show');
  }
});

const toggleButton = document.querySelector('.toggle-button');
const navbarLinks = document.querySelector('.navbar-links');

toggleButton.addEventListener('click', () => {
  navbarLinks.classList.toggle('active');
});

document.addEventListener('click', (event) => {
  const isClickInsideNavbarLinks = navbarLinks.contains(event.target);
  const isClickInsideToggleButton = toggleButton.contains(event.target);

  if (!isClickInsideNavbarLinks && !isClickInsideToggleButton && navbarLinks.classList.contains('active')) {
    navbarLinks.classList.remove('active');
  }
});
  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBDUAF3qJGhLYQJPHyWwY0JzonN5l8ERzE",
    authDomain: "mnthen-3151d.firebaseapp.com",
    projectId: "mnthen-3151d",
    storageBucket: "mnthen-3151d.appspot.com",
    messagingSenderId: "416231360428",
    appId: "1:416231360428:web:36f69cc231be2d84a8dc09"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // Check if user is authenticated
  firebase.auth().onAuthStateChanged((user) => {
    const accountLink = document.getElementById('account-link');
    if (user) {
      // User is logged in, update the link to point to the account page
      accountLink.href = 'account.html';
      accountLink.innerHTML = '<i class="fas fa-user-circle" style="margin-right: 5px"></i><span> Account Info</span>';
    } else {
      // User is not logged in, revert the link back to Sign In | Register
      accountLink.href = 'login.html';
      accountLink.innerHTML = '<i class="fas fa-user" style="margin-right: 5px"></i><span> Log In <span>|</span> Register</span>';
    }
  });
</script>
    
    <!-- Pagination -->
<div id="pagination"></div>

    <script src="blog_articles.js"></script>
    <script>
 function searchArticles(query) {
    // Define a list of stop words to exclude
    const stopWords = ['and'];

    // Splitting the query into individual lowercase keywords and filtering out empty strings and stop words
    const keywords = query.toLowerCase().split(' ')
                        .filter(kw => kw.trim() !== '' && !stopWords.includes(kw));

    // Filtering the blogArticles to find matches with any of the keywords
    return blogArticles.filter(article => {
        const articleText = (article.headline + ' ' + article.blurb + ' ' + article.keywords.join(' ')).toLowerCase();
        return keywords.some(keyword => articleText.includes(keyword));
    });
}

function displaySearchResults() {
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('query');
    
  // Handling empty or whitespace-only query
if (!query || !query.trim()) {
    const resultsContainer = document.getElementById('search-results');
    resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px; font-size: 22px; color: #333;">Please enter a search term.</div>';
    return;
}

    const page = parseInt(urlParams.get('page')) || 0;
    const resultsPerPage = 10;
    const results = searchArticles(query);
    const resultsContainer = document.getElementById('search-results');
    const resultsSummary = document.getElementById('search-summary');

    // Pagination calculations
    const startIndex = page * resultsPerPage;
    const endIndex = startIndex + resultsPerPage;
    const paginatedResults = results.slice(startIndex, endIndex);

    // Update search summary
    resultsSummary.textContent = `Search results for "${query}" (${results.length} ${results.length === 1 ? 'item' : 'items'})`;

    // Handle no results
    if (results.length === 0) {
        resultsContainer.innerHTML = `
            <div style="max-width: 90%; margin: 30px auto; padding: 15px; background-color: #fff; border-radius: 10px; text-align: center;">
                <p style="margin: 0; font-size: 1.2rem;">No results found.</p>
            </div>`;
        return;
    }

    // Display paginated results
    const resultsHtml = paginatedResults.map(article => `
        <div class="article d-flex align-items-center mb-4">
            <div class="flex-grow-1">
                <h3 class="article-title mb-1">
                    <i class="fas ${article.icon} article-icon mr-2"></i>
                    <a href="${article.url}" class="text-dark">${article.headline}</a>
                </h3>
                <p class="mb-0">${article.blurb}</p>
            </div>
            <img src="${article.image}" alt="${article.headline}" class="article-img ml-3" style="width: 110px; height: 100px;">
        </div>
    `).join('');

    resultsContainer.innerHTML = resultsHtml;

    // Add Pagination Controls (assuming this function is implemented elsewhere)
    addPaginationControls(results.length, resultsPerPage, page, query);
}

function addPaginationControls(totalResults, resultsPerPage, currentPage, query) {
    const totalPages = Math.ceil(totalResults / resultsPerPage);
    let paginationHtml = '<div class="pagination">';

    for (let i = 0; i < totalPages; i++) {
        paginationHtml += `<a href="/results.html?query=${encodeURIComponent(query)}&page=${i}" class="${i === currentPage ? 'active' : ''}">${i + 1}</a>`;
    }

    paginationHtml += '</div>';
    document.getElementById('pagination').innerHTML = paginationHtml;
}

// Call the function on page load
displaySearchResults();

    </script>

  <script>
document.addEventListener('DOMContentLoaded', function() {
  // Load header and footer first
  Promise.all([
    fetch('/section/header.html').then(response => response.text()),
    fetch('/section/footer.html').then(response => response.text())
  ])
  .then(([headerData, footerData]) => {
    const headerPlaceholder = document.getElementById('header-placeholder');
    const footerPlaceholder = document.getElementById('footer-placeholder');
    
    if (headerPlaceholder) headerPlaceholder.innerHTML = headerData;
    if (footerPlaceholder) footerPlaceholder.innerHTML = footerData;

    // Initialize after DOM update
    setTimeout(initializeNavigation, 0);
  })
  .catch(error => {
    console.error('Error loading content:', error);
    const headerPlaceholder = document.getElementById('header-placeholder');
    if (headerPlaceholder) {
      headerPlaceholder.innerHTML = '<p>Error loading content. Please refresh the page.</p>';
    }
  });
});

function initializeNavigation() {
  const mobileMenuBtn = document.querySelector('.mnthen-mobile-menu');
  const mainNav = document.querySelector('.mnthen-nav');
  const dropdownBtns = document.querySelectorAll('.mnthen-dropdown-btn');

  if (mobileMenuBtn && mainNav) {
    // Mobile menu toggle
    mobileMenuBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      this.classList.toggle('active');
      mainNav.classList.toggle('active');
    });

    // Dropdown functionality
    dropdownBtns.forEach(btn => {
      // Handle both click and touch events
      ['click', 'touchstart'].forEach(eventType => {
        btn.addEventListener(eventType, function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          // Close other dropdowns
          dropdownBtns.forEach(otherBtn => {
            if (otherBtn !== btn) {
              otherBtn.classList.remove('active');
              otherBtn.nextElementSibling?.classList.remove('active');
            }
          });
          
          // Toggle current dropdown
          this.classList.toggle('active');
          const dropdownContent = this.nextElementSibling;
          if (dropdownContent) {
            dropdownContent.classList.toggle('active');
          }
        });
      });
    });

    // Close dropdowns when clicking/touching outside
    ['click', 'touchstart'].forEach(eventType => {
      document.addEventListener(eventType, function(e) {
        const isClickInsideNav = e.target.closest('.mnthen-nav');
        const isClickInsideMenu = e.target.closest('.mnthen-mobile-menu');
        
        if (!isClickInsideNav && !isClickInsideMenu) {
          mainNav.classList.remove('active');
          mobileMenuBtn.classList.remove('active');
          
          dropdownBtns.forEach(btn => {
            btn.classList.remove('active');
            btn.nextElementSibling?.classList.remove('active');
          });
        }
      });
    });

    // Handle window resize
    window.addEventListener('resize', function() {
      if (window.innerWidth > 768) {
        mainNav.classList.remove('active');
        mobileMenuBtn.classList.remove('active');
        
        dropdownBtns.forEach(btn => {
          btn.classList.remove('active');
          btn.nextElementSibling?.classList.remove('active');
        });
      }
    });
  }
}
</script>

      <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  
</body>
</html>
