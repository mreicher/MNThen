<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Community Markers Map</title>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">
  
  <style>
    :root {
      --primary-color: #2563eb;
      --primary-hover: #1d4ed8;
      --text-color: #1f2937;
      --bg-color: #f8fafc;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body, html {
      height: 100%;
      font-family: system-ui, -apple-system, sans-serif;
      color: var(--text-color);
      overflow: hidden;
      background: var(--bg-color);
    }

    .page {
      height: 100vh;
      width: 100vw;
      position: absolute;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .search-page {
      background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.7)),
                  url('https://images.unsplash.com/photo-1486870591958-9b9d0d1dda99?w=1200&auto=format&fit=crop&q=80') center/cover;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2;
    }

    .hero-content {
      text-align: center;
      color: white;
      margin-bottom: 2rem;
      max-width: 800px;
      padding: 0 1rem;
    }

    .hero-content h1 {
      font-size: 3.5rem;
      font-weight: 800;
      margin-bottom: 1rem;
      line-height: 1.2;
    }

    .hero-content p {
      font-size: 1.25rem;
      margin-bottom: 2rem;
      opacity: 0.9;
    }

    .hero-content a {
      color: white;
      text-decoration: underline;
      cursor: pointer;
      transition: opacity 0.2s;
    }

    .hero-content a:hover {
      opacity: 0.8;
    }

    .search-container {
      width: 100%;
      max-width: 600px;
      background: white;
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      margin: 0 auto;
    }

    .search-bar {
      display: flex;
      gap: 0.75rem;
      width: 100%;
    }

    .search-input {
      flex: 1;
      padding: 0.75rem 1.25rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.75rem;
      font-size: 1rem;
      outline: none;
      transition: all 0.2s;
    }

    .search-input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .search-button {
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 0.75rem;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .search-button:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
    }

    .search-button:active {
      transform: translateY(0);
    }

    .map-page {
      transform: translateY(100%);
      z-index: 1;
    }

    #map {
      height: 100vh;
      width: 100%;
    }

    .scroll-down {
      position: absolute;
      bottom: 2rem;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .scroll-down:hover {
      transform: translateY(3px);
    }

    .scroll-down span {
      font-size: 1.125rem;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .marker-popup {
      max-width: 300px;
    }

    .marker-popup img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .marker-popup h3 {
      color: var(--text-color);
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
    }

    .marker-popup p {
      color: #4b5563;
      line-height: 1.5;
      margin-bottom: 0.5rem;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      padding: 1rem;
    }

    .modal-content {
      background: white;
      max-width: 500px;
      margin: 2rem auto;
      padding: 2rem;
      border-radius: 1rem;
      position: relative;
    }

    .modal h2 {
      color: var(--text-color);
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-color);
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 0.5rem;
      font-size: 1rem;
      transition: all 0.2s;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .close-modal {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 1.5rem;
      color: #6b7280;
      cursor: pointer;
      transition: color 0.2s;
    }

    .close-modal:hover {
      color: var(--text-color);
    }

    .notification {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 500;
      z-index: 1100;
      transform: translateX(150%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: #ecfdf5;
      color: #047857;
      border: 1px solid #a7f3d0;
    }

    .notification.error {
      background: #fef2f2;
      color: #b91c1c;
      border: 1px solid #fecaca;
    }

    .add-marker-btn {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 3.5rem;
      height: 3.5rem;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 9999px;
      font-size: 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      transition: all 0.2s;
      z-index: 900;
    }

    .add-marker-btn:hover {
      background: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 8px -1px rgba(0, 0, 0, 0.1);
    }

    .about-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
      max-width: 500px;
      width: 90%;
      z-index: 1001;
    }

    .about-popup h2 {
      color: var(--primary-color);
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .about-popup p {
      color: var(--text-color);
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }

    /* Floating Menu Styles */
    .floating-menu {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 1000;
    }

    .floating-btn {
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 50%;
      width: 3rem;
      height: 3rem;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      transition: all 0.2s;
    }

    .floating-btn:hover {
      background: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 8px -1px rgba(0, 0, 0, 0.1);
    }

    .menu-content {
      display: none;
      position: absolute;
      right: 0;
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      padding: 0.5rem;
      margin-top: 0.5rem;
    }

    .menu-content a {
      display: block;
      padding: 0.5rem 1rem;
      color: var(--text-color);
      text-decoration: none;
      border-radius: 0.25rem;
      transition: background 0.2s;
    }

    .menu-content a:hover {
      background: var(--bg-color);
    }

    @media (max-width: 640px) {
      .hero-content h1 {
        font-size: 2.5rem;
      }

      .hero-content p {
        font-size: 1.125rem;
      }

      .search-container {
        padding: 1rem;
        margin: 0 1rem;
      }

      .search-bar {
        flex-direction: column;
      }

      .search-button {
        width: 100%;
      }

      .modal-content {
        margin: 1rem;
        padding: 1.5rem;
      }

      .about-popup {
        width: calc(100% - 2rem);
        margin: 0 1rem;
      }
    }
  </style>
</head>
<body>
  <!-- Floating Menu -->
  <div class="floating-menu" id="floatingMenu">
    <button class="floating-btn" id="floatingBtn">â˜°</button>
    <div class="menu-content" id="menuContent">
      <a href="#" id="homeLink">Home</a>
      <a href="#" id="aboutLink">About Us</a>
      <a href="#" id="loginLink">Login/Join</a>
      <a href="#" id="placeholderLink1">Placeholder 1</a>
      <a href="#" id="placeholderLink2">Placeholder 2</a>
    </div>
  </div>

  <!-- Search Page -->
  <div class="page search-page" id="searchPage">
    <div class="hero-content">
      <h1>Community Markers</h1>
      <p>Discover and share meaningful places across Minnesota.</p>
      <div class="search-container">
        <div class="search-bar">
          <input type="text" class="search-input" placeholder="Search for a location..." id="searchInput">
          <button class="search-button" id="searchButton">Search Location</button>
        </div>
      </div>
    </div>
    <div class="scroll-down" id="scrollDown">
      <span>View Map</span>
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M7 13l5 5 5-5M7 6l5 5 5-5"/>
      </svg>
    </div>
  </div>

  <!-- Map Page -->
  <div class="page map-page" id="mapPage">
    <div id="map"></div>
    <button class="add-marker-btn" id="addMarkerBtn">+</button>
  </div>

  <!-- Overlay -->
  <div class="overlay" id="overlay"></div>
  
  <!-- About Popup -->
  <div class="about-popup" id="aboutPopup">
    <span class="close-modal" id="closeAbout">&times;</span>
    <h2>About Community Markers</h2>
    <p>
      Community Markers is a collaborative platform where users can create and discover meaningful locations around the world. Whether it's a historical landmark, a hidden gem, or a personal memory spot, you can share it with the community.
    </p>
    <p>
      Our mission is to create a global map of stories and experiences, connecting people through the places that matter to them. Join us in building this collective memory of special locations and their significance to different communities.
    </p>
  </div>

  <!-- Marker Modal -->
  <div class="modal" id="markerModal">
    <div class="modal-content">
      <span class="close-modal" id="closeModal">&times;</span>
      <h2>Add New Marker</h2>
      <form id="markerForm">
        <div class="form-group">
          <label for="title">Title</label>
          <input type="text" id="title" required>
        </div>
        <div class="form-group">
          <label for="description">Description</label>
          <textarea id="description" rows="3" required></textarea>
        </div>
        <div class="form-group">
          <label for="image">Image URL</label>
          <input type="url" id="image" placeholder="https://example.com/image.jpg">
        </div>
        <div class="form-group">
          <label for="date">Date</label>
          <input type="date" id="date" required>
        </div>
        <button type="submit" class="search-button">Add Marker</button>
      </form>
    </div>
  </div>

  <!-- Login/Join Modal -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <span class="close-modal" id="closeLoginModal">&times;</span>
      <h2>Login/Join</h2>
      <form id="loginForm">
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" required>
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" required>
        </div>
        <button type="submit" class="search-button">Login/Join</button>
      </form>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification"></div>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  
<script>
    // DOM Elements
    const searchPage = document.getElementById('searchPage');
    const mapPage = document.getElementById('mapPage');
    const scrollDown = document.getElementById('scrollDown');
    const searchInput = document.getElementById('searchInput');
    const searchButton = document.getElementById('searchButton');
    const addMarkerBtn = document.getElementById('addMarkerBtn');
    const markerModal = document.getElementById('markerModal');
    const closeModal = document.getElementById('closeModal');
    const markerForm = document.getElementById('markerForm');
    const notification = document.getElementById('notification');
    const titleInput = document.getElementById('title');
    const descriptionInput = document.getElementById('description');
    const imageInput = document.getElementById('image');
    const dateInput = document.getElementById('date');
    const aboutLink = document.getElementById('aboutLink');
    const aboutPopup = document.getElementById('aboutPopup');
    const overlay = document.getElementById('overlay');
    const closeAbout = document.getElementById('closeAbout');
    const floatingBtn = document.getElementById('floatingBtn');
    const menuContent = document.getElementById('menuContent');
    const loginLink = document.getElementById('loginLink');
    const loginModal = document.getElementById('loginModal');
    const closeLoginModal = document.getElementById('closeLoginModal');
    const loginForm = document.getElementById('loginForm');

    // Map state
    let map = null;
    let markers = null;
    let tempMarker = null;
    let markersData = JSON.parse(localStorage.getItem('markers') || '[]');

    // Floating Menu Toggle
    floatingBtn.addEventListener('click', (e) => {
        e.stopPropagation(); // Prevent event from bubbling up
        menuContent.style.display = menuContent.style.display === 'block' ? 'none' : 'block';
    });

    // Close Menu When Clicking Outside
    window.addEventListener('click', (e) => {
        if (!e.target.matches('.floating-btn') && !e.target.matches('.menu-content a')) {
            menuContent.style.display = 'none';
        }
    });

    // Open Login Modal
    loginLink.addEventListener('click', (e) => {
        e.preventDefault();
        loginModal.style.display = 'block';
        overlay.style.display = 'block';
    });

    // Close Login Modal
    closeLoginModal.addEventListener('click', () => {
        loginModal.style.display = 'none';
        overlay.style.display = 'none';
    });

    // Handle Login Form Submission
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        // Add your login/join logic here
        showNotification('Login/Join functionality coming soon!', 'success');
        loginModal.style.display = 'none';
        overlay.style.display = 'none';
    });

    // About Popup Handlers
    aboutLink.addEventListener('click', (e) => {
        e.preventDefault();
        aboutPopup.style.display = 'block';
        overlay.style.display = 'block';
    });

    closeAbout.addEventListener('click', () => {
        aboutPopup.style.display = 'none';
        overlay.style.display = 'none';
    });

    overlay.addEventListener('click', () => {
        aboutPopup.style.display = 'none';
        overlay.style.display = 'none';
    });

    // Initialize map
    function initializeMap() {
        if (!map) {
            map = L.map('map').setView([44.9778, -93.2650], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            markers = L.markerClusterGroup();
            map.addLayer(markers);

            // Add click handler for adding new markers
            map.on('click', function(e) {
                if (tempMarker) {
                    map.removeLayer(tempMarker);
                }
                tempMarker = L.marker(e.latlng).addTo(map);
                markerModal.style.display = 'block';
            });

            loadMarkers();
        }
    }

    // Load existing markers
    function loadMarkers() {
        markers.clearLayers();
        markersData.forEach(data => {
            const marker = L.marker([data.lat, data.lng]);
            const popupContent = `
                <div class="marker-popup">
                    ${data.image ? `<img src="${data.image}" alt="${data.title}">` : ''}
                    <h3>${data.title}</h3>
                    <p>${data.description}</p>
                    <p><small>Added on: ${new Date(data.date).toLocaleDateString()}</small></p>
                </div>
            `;
            marker.bindPopup(popupContent);
            markers.addLayer(marker);
        });
    }

    // Navigation
    scrollDown.addEventListener('click', () => {
        searchPage.style.transform = 'translateY(-100%)';
        mapPage.style.transform = 'translateY(0)';
        setTimeout(initializeMap, 500);
    });

    // Search handler
    searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            const query = this.value.trim();
            if (!query) return;

            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query + ', Minnesota, USA')}`)
                .then(response => response.json())
                .then(data => {
                    const minnesotaResults = data.filter(result => result.display_name.includes('Minnesota'));
                    if (minnesotaResults.length > 0) {
                        const { lat, lon } = minnesotaResults[0];
                        searchPage.style.transform = 'translateY(-100%)';
                        mapPage.style.transform = 'translateY(0)';
                        
                        setTimeout(() => {
                            initializeMap();
                            map.setView([parseFloat(lat), parseFloat(lon)], 13);
                            showNotification('Location found in Minnesota!', 'success');
                        }, 500);
                    } else {
                        showNotification('Location not found in Minnesota', 'error');
                    }
                })
                .catch(() => {
                    showNotification('Error searching location', 'error');
                });
        }
    });

    // Form submission handler
    markerForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!tempMarker) return;

        const newMarker = {
            title: titleInput.value.trim(),
            description: descriptionInput.value.trim(),
            image: imageInput.value.trim(),
            date: dateInput.value,
            lat: tempMarker.getLatLng().lat,
            lng: tempMarker.getLatLng().lng,
            timestamp: Date.now()
        };

        markersData.push(newMarker);
        localStorage.setItem('markers', JSON.stringify(markersData));
        
        map.removeLayer(tempMarker);
        tempMarker = null;
        markerModal.style.display = 'none';
        markerForm.reset();
        
        loadMarkers();
        showNotification('Marker added successfully!', 'success');
    });

    // Modal close handler
    closeModal.addEventListener('click', function() {
        markerModal.style.display = 'none';
        if (tempMarker) {
            map.removeLayer(tempMarker);
            tempMarker = null;
        }
    });

    // Click outside modal to close
    window.addEventListener('click', function(e) {
        if (e.target === markerModal) {
            markerModal.style.display = 'none';
            if (tempMarker) {
                map.removeLayer(tempMarker);
                tempMarker = null;
            }
        }
    });

    // Notification handler
    function showNotification(message, type) {
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.style.display = 'block';
        
        setTimeout(() => {
            notification.style.display = 'none';
        }, 3000);
    }

    // Prevent form submission on enter in inputs
    markerForm.querySelectorAll('input').forEach(input => {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
            }
        });
    });

    // Initialize date input to today's date
    dateInput.valueAsDate = new Date();

    // Initialize markers on load
    loadMarkers();
</script>
</body>
</html>
