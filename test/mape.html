<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minnesota Then - A Community History Wiki</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --wiki-bg: #f8f9fa;
            --wiki-text: #202122;
            --wiki-link: #0645ad;
            --wiki-link-visited: #0b0080;
            --wiki-border: #a2a9b1;
            --wiki-header: #eaecf0;
        }

        body {
            font-family: 'Linux Libertine', 'Georgia', 'Times', serif;
            background-color: var(--wiki-bg);
            color: var(--wiki-text);
            line-height: 1.6;
        }

        .wiki-header {
            background-color: var(--wiki-header);
            border-bottom: 1px solid var(--wiki-border);
            padding: 0.5rem 0;
        }

        .wiki-title {
            font-family: 'Linux Libertine', 'Georgia', 'Times', serif;
            font-size: 2.5rem;
            color: var(--wiki-text);
        }

        .wiki-subtitle {
            font-style: italic;
            color: #666;
        }

        .sidebar {
            background-color: white;
            border-right: 1px solid var(--wiki-border);
            padding: 1rem;
            height: 100%;
        }

        @media (max-width: 768px) {
            .sidebar {
                border-right: none;
                border-bottom: 1px solid var(--wiki-border);
                margin-bottom: 1rem;
            }
        }

        .content-area {
            background-color: white;
            border: 1px solid var(--wiki-border);
            border-radius: 3px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .section-header {
            border-bottom: 1px solid var(--wiki-border);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
        }

        .wiki-footer {
            background-color: var(--wiki-header);
            border-top: 1px solid var(--wiki-border);
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .nav-link {
            color: var(--wiki-link);
            padding: 0.3rem 0;
        }

        .nav-link:hover {
            color: var(--wiki-link-visited);
            background-color: var(--wiki-header);
        }

        .edit-toolbar {
            background-color: var(--wiki-header);
            border: 1px solid var(--wiki-border);
            border-radius: 3px;
            padding: 0.5rem;
            margin-bottom: 1rem;
        }

        .edit-toolbar button {
            margin-right: 0.5rem;
        }

        .content-meta {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 1rem;
        }

        .approval-pending {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 3px;
        }

        .toc {
            background-color: #f8f9fa;
            border: 1px solid var(--wiki-border);
            padding: 1rem;
            margin: 1rem 0;
            width: fit-content;
        }

        .toc-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .toc ul {
            list-style-type: none;
            padding-left: 1rem;
        }

        .toc li {
            margin: 0.3rem 0;
        }

        .wiki-section {
            margin-bottom: 2rem;
        }

        .wiki-section h2 {
            border-bottom: 1px solid var(--wiki-border);
            padding-bottom: 0.3rem;
        }

        .references {
            font-size: 0.9rem;
            border-top: 1px solid var(--wiki-border);
            margin-top: 2rem;
            padding-top: 1rem;
        }

        .image-caption {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            margin-top: 0.5rem;
        }

        .edit-preview {
            border: 1px solid var(--wiki-border);
            padding: 1rem;
            margin: 1rem 0;
            background-color: var(--wiki-bg);
        }

        #auth-status {
            position: absolute;
            top: 1rem;
            right: 1rem;
        }

        @media (max-width: 576px) {
            #auth-status {
                position: static;
                margin-top: 1rem;
                text-align: center;
            }

            .wiki-title {
                font-size: 2rem;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <header class="wiki-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="wiki-title">Minnesota Then</h1>
                    <p class="wiki-subtitle">A Community History Wiki</p>
                </div>
                <div class="col-md-4">
                    <div id="auth-status" class="d-flex justify-content-end">
                        <button id="login-btn" class="btn btn-outline-primary me-2">Login</button>
                        <button id="signup-btn" class="btn btn-primary">Sign Up</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container mt-4">
        <div class="row">
            <div class="col-md-3">
                <div class="sidebar">
                    <h5>Navigation</h5>
                    <ul class="nav flex-column" id="sidebar-nav">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-page="home">Main Page</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="recent-changes">Recent Changes</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="random-page">Random Article</a>
                        </li>
                        <li class="nav-item" id="create-page-item" style="display: none;">
                            <a class="nav-link" href="#" data-page="create-page">Create New Article</a>
                        </li>
                    </ul>

                    <h5 class="mt-4">Search</h5>
                    <div class="input-group">
                        <input type="text" class="form-control" id="search-input" placeholder="Search articles...">
                        <button class="btn btn-outline-secondary" id="search-btn">
                            Search
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-md-9">
                <div class="content-area">
                    <div id="page-header">
                        <h1 id="page-title">Welcome to Minnesota Then</h1>
                        <div class="content-meta" id="page-meta"></div>
                    </div>

                    <div id="page-content">
                        <div class="toc" id="toc">
                            <div class="toc-title">Contents</div>
                            <ul>
                                <li>1. <a href="#introduction">Introduction</a></li>
                                <li>2. <a href="#getting-started">Getting Started</a></li>
                                <li>3. <a href="#featured">Featured Articles</a></li>
                            </ul>
                        </div>

                        <section id="introduction" class="wiki-section">
                            <h2>Introduction</h2>
                            <p>Welcome to Minnesota Then, a community-driven historical wiki dedicated to preserving and sharing the rich history of Minnesota. Our goal is to create a comprehensive resource that documents the people, places, events, and stories that have shaped our state.</p>
                        </section>

                        <section id="getting-started" class="wiki-section">
                            <h2>Getting Started</h2>
                            <p>To contribute to Minnesota Then:</p>
                            <ul>
                                <li>Create an account to start contributing</li>
                                <li>Browse existing articles for inspiration</li>
                                <li>Submit new articles or edit existing ones</li>
                                <li>All contributions are reviewed before publication</li>
                            </ul>
                        </section>

                        <section id="featured" class="wiki-section">
                            <h2>Featured Articles</h2>
                            <p>Explore some of our featured articles:</p>
                            <div id="featured-articles">
                                Loading featured articles...
                            </div>
                        </section>
                    </div>

                    <div id="edit-section" class="mt-4" style="display: none;">
                        <div class="edit-toolbar">
                            <button class="btn btn-sm btn-outline-secondary" data-format="header">Add Header</button>
                            <button class="btn btn-sm btn-outline-secondary" data-format="image">Add Image</button>
                            <button class="btn btn-sm btn-outline-secondary" data-format="reference">Add Reference</button>
                        </div>
                        <form id="edit-form">
                            <div class="mb-3">
                                <label for="edit-title" class="form-label">Article Title</label>
                                <input type="text" class="form-control" id="edit-title" required>
                            </div>
                            <div class="mb-3">
                                <label for="edit-content" class="form-label">Content</label>
                                <textarea class="form-control" id="edit-content" rows="15" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="edit-summary" class="form-label">Edit Summary</label>
                                <input type="text" class="form-control" id="edit-summary" placeholder="Briefly describe your changes">
                            </div>
                            <div class="edit-preview mb-3">
                                <h6>Preview</h6>
                                <div id="edit-preview-content"></div>
                            </div>
                            <button type="submit" class="btn btn-primary">Submit for Review</button>
                            <button type="button" class="btn btn-secondary" id="cancel-edit">Cancel</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="wiki-footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5>About Minnesota Then</h5>
                    <p>A community-driven historical wiki dedicated to preserving Minnesota's rich history.</p>
                </div>
                <div class="col-md-4">
                    <h5>Contribute</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" data-page="guidelines">Content Guidelines</a></li>
                        <li><a href="#" data-page="help">Help & Documentation</a></li>
                        <li><a href="#" data-page="contact">Contact</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Legal</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" data-page="privacy">Privacy Policy</a></li>
                        <li><a href="#" data-page="terms">Terms of Use</a></li>
                        <li>© 2024 Minnesota Then</li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Auth Modal -->
    <div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="authModalTitle">Login</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="auth-form">
                        <div class="mb-3">
                            <label for="auth-email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="auth-email" required>
                        </div>
                        <div class="mb-3">
                            <label for="auth-password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="auth-password" required>
                        </div>
                        <div id="auth-error" class="alert alert-danger d-none"></div>
                        <button type="submit" class="btn btn-primary" id="auth-submit-btn">Login</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-link" id="switch-auth-mode">Need to sign up?</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBDUAF3qJGhLYQJPHyWwY0JzonN5l8ERzE",
            authDomain: "mnthen-3151d.firebaseapp.com",
            projectId: "mnthen-3151d",
            storageBucket: "mnthen-3151d.appspot.com",
            messagingSenderId: "416231360428",
            appId: "1:416231360428:web:36f69cc231be2d84a8dc09"
        };

        // Initialize Firebase
        let firebaseApp;
        if (!firebase.apps.length) {
            firebaseApp = firebase.initializeApp(firebaseConfig);
        } else {
            firebaseApp = firebase.app();
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM Elements
        const loginBtn = document.getElementById('login-btn');
        const signupBtn = document.getElementById('signup-btn');
        const authStatus = document.getElementById('auth-status');
        const authModal = new bootstrap.Modal(document.getElementById('authModal'));
        const authForm = document.getElementById('auth-form');
        const authEmail = document.getElementById('auth-email');
        const authPassword = document.getElementById('auth-password');
        const authSubmitBtn = document.getElementById('auth-submit-btn');
        const authModalTitle = document.getElementById('authModalTitle');
        const switchAuthMode = document.getElementById('switch-auth-mode');
        const authError = document.getElementById('auth-error');
        const pageTitle = document.getElementById('page-title');
        const pageContent = document.getElementById('page-content');
        const pageMeta = document.getElementById('page-meta');
        const editSection = document.getElementById('edit-section');
        const editForm = document.getElementById('edit-form');
        const editTitle = document.getElementById('edit-title');
        const editContent = document.getElementById('edit-content');
        const editPreviewContent = document.getElementById('edit-preview-content');
        const editSummary = document.getElementById('edit-summary');
        const cancelEdit = document.getElementById('cancel-edit');
        const createPageItem = document.getElementById('create-page-item');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const sidebarNav = document.getElementById('sidebar-nav');

        // State variables
        let isLoginMode = true;
        let currentPageId = 'home';
        let currentUser = null;
        let isEditing = false;

        // Initialize the app
        function init() {
            setupAuth();
            setupNavigation();
            setupEditor();
            loadPage(currentPageId);
            loadFeaturedArticles();
        }

        // Authentication setup
        function setupAuth() {
            auth.onAuthStateChanged(user => {
                currentUser = user;
                updateAuthUI();
            });

            loginBtn.addEventListener('click', () => {
                isLoginMode = true;
                updateAuthModalUI();
                authModal.show();
            });

            signupBtn.addEventListener('click', () => {
                isLoginMode = false;
                updateAuthModalUI();
                authModal.show();
            });

            switchAuthMode.addEventListener('click', () => {
                isLoginMode = !isLoginMode;
                updateAuthModalUI();
            });

            authForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = authEmail.value;
                const password = authPassword.value;

                try {
                    if (isLoginMode) {
                        await auth.signInWithEmailAndPassword(email, password);
                    } else {
                        await auth.createUserWithEmailAndPassword(email, password);
                    }
                    authModal.hide();
                } catch (error) {
                    authError.textContent = error.message;
                    authError.classList.remove('d-none');
                }
            });
        }

        function updateAuthModalUI() {
            authModalTitle.textContent = isLoginMode ? 'Login' : 'Sign Up';
            authSubmitBtn.textContent = isLoginMode ? 'Login' : 'Sign Up';
            switchAuthMode.textContent = isLoginMode ? 'Need to sign up?' : 'Already have an account?';
            authForm.reset();
            authError.classList.add('d-none');
        }

        function updateAuthUI() {
            if (currentUser) {
                authStatus.innerHTML = `
                    <span class="user-greeting me-2">Welcome, ${currentUser.email}</span>
                    <button id="logout-btn" class="btn btn-outline-primary">Logout</button>
                `;
                document.getElementById('logout-btn').addEventListener('click', () => auth.signOut());
                createPageItem.style.display = 'block';
            } else {
                authStatus.innerHTML = `
                    <button id="login-btn" class="btn btn-outline-primary me-2">Login</button>
                    <button id="signup-btn" class="btn btn-primary">Sign Up</button>
                `;
                document.getElementById('login-btn').addEventListener('click', () => {
                    isLoginMode = true;
                    updateAuthModalUI();
                    authModal.show();
                });
                document.getElementById('signup-btn').addEventListener('click', () => {
                    isLoginMode = false;
                    updateAuthModalUI();
                    authModal.show();
                });
                createPageItem.style.display = 'none';
            }
        }

        // Navigation setup
        function setupNavigation() {
            sidebarNav.addEventListener('click', (e) => {
                e.preventDefault();
                if (e.target.tagName === 'A') {
                    const pageId = e.target.getAttribute('data-page');
                    loadPage(pageId);
                }
            });

            searchBtn.addEventListener('click', () => {
                const searchTerm = searchInput.value.trim();
                if (searchTerm) {
                    searchPages(searchTerm);
                }
            });

            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const searchTerm = searchInput.value.trim();
                    if (searchTerm) {
                        searchPages(searchTerm);
                    }
                }
            });
        }

        // Editor setup
        function setupEditor() {
            const toolbar = document.querySelector('.edit-toolbar');
            toolbar.addEventListener('click', (e) => {
                if (e.target.hasAttribute('data-format')) {
                    const format = e.target.getAttribute('data-format');
                    insertFormat(format);
                }
            });

            editContent.addEventListener('input', () => {
                updatePreview();
            });

            editForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!currentUser) {
                    alert('You must be logged in to edit pages.');
                    return;
                }

                const title = editTitle.value;
                const content = editContent.value;
                const summary = editSummary.value || 'No summary provided';

                try {
                    await submitRevision(title, content, summary);
                    isEditing = false;
                    editSection.style.display = 'none';
                    editForm.reset();
                    alert('Your changes have been submitted for approval. Thank you!');
                    loadPage(currentPageId);
                } catch (error) {
                    console.error('Error submitting revision:', error);
                    alert('There was an error submitting your changes. Please try again.');
                }
            });

            cancelEdit.addEventListener('click', () => {
                isEditing = false;
                editSection.style.display = 'none';
            });
        }

        function insertFormat(format) {
            const textarea = editContent;
            let template = '';
            switch (format) {
                case 'header':
                    template = '\n== New Section ==\n';
                    break;
                case 'image':
                    template = '\n[[Image:filename.jpg|thumb|Caption text]]\n';
                    break;
                case 'reference':
                    template = '<ref>Citation needed</ref>';
                    break;
            }
            
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const text = textarea.value;
            textarea.value = text.substring(0, start) + template + text.substring(end);
            textarea.focus();
            textarea.selectionStart = start + template.length;
            textarea.selectionEnd = start + template.length;
            updatePreview();
        }

        function updatePreview() {
            const content = editContent.value;
            editPreviewContent.innerHTML = markdownToHtml(content);
        }

        async function submitRevision(title, content, summary) {
            const revisionData = {
                pageId: currentPageId,
                title: title,
                content: content,
                summary: summary,
                author: currentUser.email,
                authorId: currentUser.uid,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'pending',
                isNewPage: !await pageExists(currentPageId)
            };

            await db.collection('revisions').add(revisionData);
        }

        async function pageExists(pageId) {
            const doc = await db.collection('pages').doc(pageId).get();
            return doc.exists;
        }

        // Page loading
        async function loadPage(pageId) {
            currentPageId = pageId;
            try {
                const doc = await db.collection('pages').doc(pageId).get();
                if (doc.exists) {
                    const pageData = doc.data();
                    displayPage(pageData);
                } else {
                    displayDefaultContent(pageId);
                }
            } catch (error) {
                console.error('Error loading page:', error);
                displayError();
            }
        }

        function displayPage(pageData) {
            pageTitle.textContent = pageData.title;
            pageContent.innerHTML = markdownToHtml(pageData.content);
            pageMeta.textContent = `Last modified ${formatDate(pageData.updatedAt)} by ${pageData.lastUpdatedBy}`;
            
            if (currentUser) {
                const editButton = document.createElement('button');
                editButton.className = 'btn btn-outline-primary btn-sm ms-2';
                editButton.textContent = 'Edit';
                editButton.onclick = () => startEditing(pageData);
                pageMeta.appendChild(editButton);
            }
        }

        function displayDefaultContent(pageId) {
            if (pageId === 'home') {
                // Home page content is already in the HTML
                return;
            }

            pageTitle.textContent = 'Page Not Found';
            pageContent.innerHTML = `
                <div class="alert alert-info">
                    <p>This page doesn't exist yet. ${currentUser ? `<a href="#" onclick="startCreatingPage('${pageId}')">Create it?</a>` : 'Login to create it!'}</p>
                </div>
            `;
            pageMeta.textContent = '';
        }

        function displayError() {
            pageTitle.textContent = 'Error';
            pageContent.innerHTML = '<div class="alert alert-danger">There was an error loading this page. Please try again later.</div>';
            pageMeta.textContent = '';
        }

        function startEditing(pageData) {
            isEditing = true;
            editSection.style.display = 'block';
            editTitle.value = pageData.title;
            editContent.value = pageData.content;
            updatePreview();
            editSection.scrollIntoView({ behavior: 'smooth' });
        }

        function startCreatingPage(pageId) {
            isEditing = true;
            editSection.style.display = 'block';
            editTitle.value = pageId.replace(/-/g, ' ');
            editContent.value = '';
            updatePreview();
            editSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Search functionality
        async function searchPages(searchTerm) {
            pageTitle.textContent = `Search Results: "${searchTerm}"`;
            pageContent.innerHTML = '<p>Searching...</p>';
            pageMeta.textContent = '';

            try {
                const snapshot = await db.collection('pages')
                    .orderBy('title')
                    .startAt(searchTerm)
                    .endAt(searchTerm + '\uf8ff')
                    .limit(20)
                    .get();

                if (snapshot.empty) {
                    displayNoSearchResults(searchTerm);
                    return;
                }

                displaySearchResults(snapshot);
            } catch (error) {
                console.error('Error searching pages:', error);
                pageContent.innerHTML = '<div class="alert alert-danger">Error performing search. Please try again.</div>';
            }
        }

        function displayNoSearchResults(searchTerm) {
            pageContent.innerHTML = `
                <div class="alert alert-info">
                    <p>No pages found matching "${searchTerm}".</p>
                    ${currentUser ? `<p><a href="#" onclick="startCreatingPage('${generatePageId(searchTerm)}')">Create this page?</a></p>` : ''}
                </div>
            `;
        }

        function displaySearchResults(snapshot) {
            let html = '<div class="list-group">';
            snapshot.forEach(doc => {
                const page = doc.data();
                html += `
                    <a href="#" class="list-group-item list-group-item-action" onclick="loadPage('${doc.id}')">
                        <h5 class="mb-1">${page.title}</h5>
                        <p class="mb-1">${page.content.substring(0, 200)}...</p>
                        <small>Last modified ${formatDate(page.updatedAt)}</small>
                    </a>
                `;
            });
            html += '</div>';
            pageContent.innerHTML = html;
        }

        // Featured Articles
        async function loadFeaturedArticles() {
            const featuredSection = document.getElementById('featured-articles');
            try {
                const snapshot = await db.collection('pages')
                    .where('featured', '==', true)
                    .limit(3)
                    .get();

                if (snapshot.empty) {
                    featuredSection.innerHTML = '<p>No featured articles yet.</p>';
                    return;
                }

                let html = '<div class="row">';
                snapshot.forEach(doc => {
                    const article = doc.data();
                    html += `
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">${article.title}</h5>
                                    <p class="card-text">${article.content.substring(0, 100)}...</p>
                                    <a href="#" onclick="loadPage('${doc.id}')" class="btn btn-link">Read more</a>
                                </div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                featuredSection.innerHTML = html;
            } catch (error) {
                console.error('Error loading featured articles:', error);
                featuredSection.innerHTML = '<div class="alert alert-danger">Error loading featured articles.</div>';
            }
        }

        // Helper Functions
        function markdownToHtml(markdown) {
            if (!markdown) return '';
            
            return markdown
                .replace(/^==\s*(.*?)\s*==$/gm, '<h2>$1</h2>')
                .replace(/^===\s*(.*?)\s*===$/gm, '<h3>$1</h3>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\[\[Image:(.*?)\|(.*?)\|(.*?)\]\]/g, '<figure><img src="$1" alt="$3" class="img-fluid"><figcaption class="image-caption">$3</figcaption></figure>')
                .replace(/\[\[(.*?)\]\]/g, '<a href="#" onclick="loadPage(\'$1\')">$1</a>')
                .replace(/<ref>(.*?)<\/ref>/g, '<sup class="reference">[$1]</sup>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>');
        }

        function formatDate(timestamp) {
            if (!timestamp) return 'Unknown date';
            const date = timestamp.toDate();
            return new Intl.DateTimeFormat('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            }).format(date);
        }

        function generatePageId(title) {
            return title.toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-|-$/g, '');
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
