<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minnesota Then History Trivia</title>
    <link rel="shortcut icon" type="image/jpg" href="https://www.mnthen.com/images/mnthenfav.ico">
    <link pastedMRThis is super close to perfect. Don't change the game play at all but please make sure the start game modals and end of game modals look perfect. Seriously don't change anything else. I like how it looks and works. Make sure the modals are clean, well spaced, content full, responsive, and mobile friendly. If you don't need to write JS, don't but definitely fix the CSS HTML.EditLooking at your trivia game code, I can see the modals are well-structured but could use some refinement for spacing, mobile responsiveness, and overall polish. I'll focus only on the CSS and HTML for the modals without touching the gameplay functionality.modern modal design CSS responsive mobile 202510 resultsBuild a Responsive Modal using CSS ðŸš€ - DEV Communitydev.toHow To Make a Modal Box With CSS and JavaScriptw3schools.com10+ Best CSS Modal components for Modern UI (2025)purecode.aiResponsive Design Breakpoints: 2025 Playbook - DEV Communitydev.toW3.CSS Modalw3schools.com70 CSS Modal Windows | FreeFrontendfreefrontend.com41 Practical CSS Modals Exampleswpdean.comHTML Responsive Web Designw3schools.com7 Best CSS frameworks for scalable, LLM-driven appspieces.appModal Â· Bootstrapgetbootstrap.comHere's the refined CSS and HTML for your modals. I've improved the spacing, made them more responsive, and enhanced the visual hierarchy while keeping all your existing functionality intact:
html<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minnesota Then History Trivia</title>
    <link rel="shortcut icon" type="image/jpg" href="https://www.mnthen.com/images/mnthenfav.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <!-- Open Graph meta tags -->
    <meta property="og:title" content="Minnesota Then History Trivia Game">
    <meta property="og:description" content="Test your knowledge of Minnesota history in this fun trivia game!">
    <meta property="og:image" content="https://www.mnthen.com/images/index/trivia.jpg">
    <meta property="og:url" content="https://www.mnthen.com/trivia.html">
    <meta property="og:type" content="website">

    <!-- Twitter Card meta tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Minnesota Then History Trivia Game">
    <meta name="twitter:description" content="Test your knowledge of Minnesota history in this fun trivia game!">
    <meta name="twitter:image" content="https://www.mnthen.com/images/index/trivia.jpg">
    
    <link rel="stylesheet" href="https://www.mnthen.com/css/new_triv.css"> 
    <link rel="stylesheet" href="https://www.mnthen.com/css/mnthen_article_fab.css"> 

    <style>
        /* Base button style */
        #start-game-btn, .auth-btn {
            background-color: #003366; 
            color: white; 
            border: none; 
            padding: 14px 28px; 
            border-radius: 12px; 
            font-size: 1rem; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            box-shadow: 0 4px 12px rgba(0, 51, 102, 0.2);
        }

        #start-game-btn:hover, .auth-btn:hover {
            background-color: #002244;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 51, 102, 0.3);
        }
        
        /* Modal and Popup Base Styles */
        .modal, .popup, #game-end-popup {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            overflow: auto;
            backdrop-filter: blur(3px);
        }

        .modal.show, .popup.show, #game-end-popup.show {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Modal content styles */
        .modal-content, .popup-content, #game-end-popup .popup-content {
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 480px;
            max-height: 90vh;
            overflow-y: auto;
            border: none;
            position: relative;
        }

        /* Auth Modal Styles - Enhanced */
        #auth-modal .modal-content {
            padding: 2.5rem;
        }

        #auth-modal h3 {
            color: #003366;
            font-size: 1.75rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 2rem;
        }

        .tab-container {
            display: flex;
            margin: 0 0 2rem;
            border-bottom: 2px solid #f0f0f0;
            border-radius: 8px 8px 0 0;
            background-color: #f8f9fa;
            overflow: hidden;
        }

        .tab-btn {
            flex: 1;
            padding: 16px 12px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            position: relative;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            background-color: #e9ecef;
            color: #003366;
        }

        .tab-btn.active {
            color: #003366;
            font-weight: 700;
            background-color: #ffffff;
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #003366, #004488);
        }

        .auth-form {
            display: none;
            flex-direction: column;
            gap: 1.25rem;
        }

        .auth-form.active {
            display: flex;
        }

        .auth-input {
            padding: 16px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: #fafafa;
        }

        .auth-input:focus {
            outline: none;
            border-color: #003366;
            background-color: #ffffff;
            box-shadow: 0 0 0 3px rgba(0, 51, 102, 0.1);
        }

        .auth-btn {
            width: 100%;
            margin: 0.5rem 0 0;
            font-size: 1.1rem;
            padding: 16px 28px;
        }

        .auth-error {
            color: #dc3545;
            margin: 0;
            min-height: 24px;
            font-size: 0.9rem;
            text-align: left;
            padding: 0 4px;
        }

        /* Guest section enhanced */
        .guest-section {
            padding: 1.5rem 0;
            text-align: center;
        }

        .guest-section p {
            color: #666;
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }

        .guest-info-link {
            color: #003366;
            text-decoration: none;
            font-size: 0.95rem;
            margin-top: 1.5rem;
            display: inline-block;
            cursor: pointer;
            font-weight: 500;
        }

        .guest-info-link:hover {
            text-decoration: underline;
        }

        /* Password reset link styling */
        .forgot-password {
            text-align: center;
            margin: 1rem 0 0;
        }

        .forgot-password a {
            color: #666;
            font-size: 0.9rem;
            text-decoration: none;
            font-weight: 500;
        }

        .forgot-password a:hover {
            text-decoration: underline;
            color: #003366;
        }

        /* Welcome message styling */
        .welcome-message {
            font-size: 1.1rem;
            margin: 0 0 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            border-left: 5px solid #003366;
            text-align: center;
        }

        .welcome-message strong {
            color: #003366;
            font-size: 1.4rem;
            display: block;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .welcome-message p {
            color: #555;
            line-height: 1.6;
            margin: 0;
        }

        /* End Game Modal - Enhanced */
        #game-end-popup .popup-content {
            width: 95%;
            max-width: 900px;
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            padding: 0;
            display: flex;
            flex-direction: row;
            max-height: 85vh;
        }

        #game-end-popup .image-column {
            position: relative;
            flex: 0 0 45%;
            max-width: 45%;
            background: linear-gradient(135deg, #003366 0%, #004488 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #game-end-popup .image-column img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.8;
        }

        #game-end-popup .content-column {
            flex: 0 0 55%;
            max-width: 55%;
            padding: 3rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        #game-end-popup .content-column h2 {
            color: #003366;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-align: center;
        }

        #game-end-popup .content-column > p {
            color: #666;
            font-size: 1.1rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        #game-end-popup .final-score {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.95);
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: 700;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            width: 85%;
            color: #003366;
        }

        #game-end-popup .share-buttons {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin: 2rem 0;
        }

        #game-end-popup .share-btn {
            padding: 12px;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        #game-end-popup .share-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        #game-end-popup .facebook-btn {
            background-color: #3b5998;
        }

        #game-end-popup .twitter-btn {
            background-color: #1da1f2;
        }

        #game-end-popup .linkedin-btn {
            background-color: #0077b5;
        }

        #game-end-popup .game-actions {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 2rem;
        }

        #game-end-popup .game-actions button {
            padding: 14px 28px;
            font-weight: 600;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #game-end-popup .game-actions button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        #game-end-popup .play-again-btn {
            background-color: #003366;
            color: white;
        }

        #game-end-popup .exit-btn {
            background-color: #f8f9fa;
            color: #333;
            border: 2px solid #ddd;
        }

        .explore-section {
            margin: 2rem 0;
        }

        .explore-section h3 {
            color: #003366;
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 3px solid #003366;
            font-weight: 700;
        }

        .explore-section a {
            color: #0066cc;
            text-decoration: none;
            margin-bottom: 0.75rem;
            display: block;
            transition: all 0.3s ease;
            padding: 12px 16px;
            border-radius: 8px;
            background-color: #f8f9fa;
            font-weight: 500;
        }

        .explore-section a:hover {
            color: #004499;
            background-color: #e9ecef;
            transform: translateX(4px);
        }

        .explore-section a i {
            margin-right: 12px;
            color: #003366;
            width: 20px;
        }

        .share-section h4 {
            color: #003366;
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 600;
        }

        .navigation-links {
            margin: 1.5rem 0;
            padding: 1.5rem 0;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        .navigation-links a {
            display: inline-block;
            margin: 0 12px;
            color: #003366;
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .navigation-links a:hover {
            background-color: #f0f0f0;
            transform: translateY(-1px);
        }

        .navigation-links i {
            margin-right: 8px;
        }

        /* Guest Info Popup Enhanced */
        #guest-info-popup .popup-content {
            max-width: 450px;
            padding: 2.5rem;
            text-align: left;
        }

        #guest-info-popup h3 {
            color: #003366;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
        }

        #guest-info-popup ul {
            padding-left: 1.5rem;
            margin: 1.5rem 0;
        }

        #guest-info-popup li {
            margin-bottom: 0.75rem;
            color: #555;
            line-height: 1.6;
        }

        #guest-info-popup p {
            color: #666;
            line-height: 1.6;
        }

        /* Feedback popup enhanced */
        #feedback-popup .popup-content {
            max-width: 500px;
            padding: 2.5rem;
            text-align: center;
        }

        #feedback-popup #question-number {
            color: #666;
            font-size: 1rem;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        #feedback-popup #feedback-result {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }

        #feedback-popup #question-score,
        #feedback-popup #correct-answer {
            margin: 1.5rem 0;
            font-size: 1.1rem;
            padding: 1rem;
            border-radius: 8px;
            background-color: #f8f9fa;
        }

        #feedback-popup #next-question-btn {
            background-color: #003366;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1.5rem;
        }

        #feedback-popup #next-question-btn:hover {
            background-color: #002244;
            transform: translateY(-2px);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            #game-end-popup .popup-content {
                flex-direction: column;
                max-width: 95%;
                margin: 10px;
            }

            #game-end-popup .image-column,
            #game-end-popup .content-column {
                flex: 0 0 100%;
                max-width: 100%;
            }

            #game-end-popup .image-column {
                height: 200px;
            }

            #game-end-popup .content-column {
                padding: 2rem;
            }

            #game-end-popup .content-column h2 {
                font-size: 1.6rem;
            }

            .modal-content, .popup-content {
                padding: 2rem;
                margin: 10px;
                max-width: 95%;
            }

            #auth-modal .modal-content {
                padding: 2rem;
            }

            #auth-modal h3 {
                font-size: 1.5rem;
            }

            .tab-btn {
                font-size: 0.9rem;
                padding: 12px 8px;
            }

            .welcome-message {
                padding: 1.5rem;
            }

            .welcome-message strong {
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            #game-end-popup .game-actions {
                flex-direction: column;
                gap: 12px;
            }

            #game-end-popup .game-actions button {
                width: 100%;
            }

            #game-end-popup .share-buttons {
                gap: 12px;
            }

            .navigation-links a {
                display: block;
                margin: 8px 0;
            }

            .modal-content, .popup-content {
                padding: 1.5rem;
                margin: 5px;
                max-width: 98%;
            }

            #auth-modal .modal-content {
                padding: 1.5rem;
            }

            .auth-input {
                padding: 14px 16px;
            }

            .tab-container {
                margin-bottom: 1.5rem;
            }
        }

        /* Smooth animations */
        .modal, .popup {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal-content, .popup-content {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="game-title">Minnesota Then History Trivia</h1>
        <div id="timer">Time: 30s</div>
        <div id="question"></div>
        <div id="options"></div>
        <div id="score-container">
            <div id="current-score">Question Score: 100</div>
            <div id="total-score">Game Score: 0</div>
        </div>
    </div>

    <!-- Auth modal - Enhanced -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <div id="auth-content">
                <h3><i class="fas fa-landmark me-2"></i>Play Minnesota History Trivia</h3>
                <div id="auth-tabs" class="tab-container">
                    <button class="tab-btn active" data-tab="login">Log In</button>
                    <button class="tab-btn" data-tab="signup">Sign Up</button>
                    <button class="tab-btn" data-tab="guest">Guest</button>
                </div>
                
                <!-- Login Form -->
                <div id="login-form" class="auth-form active">
                    <input type="email" id="login-email" class="auth-input" placeholder="Email Address" required>
                    <input type="password" id="login-password" class="auth-input" placeholder="Password" required>
                    <p class="auth-error" id="login-error"></p>
                    <button id="login-btn" class="auth-btn">
                        <i class="fas fa-sign-in-alt me-2"></i>Log In
                    </button>
                    <div class="forgot-password">
                        <a href="#" id="reset-password-link">Forgot your password?</a>
                    </div>
                </div>
                
                <!-- Signup Form -->
                <div id="signup-form" class="auth-form">
                    <input type="text" id="signup-first-name" class="auth-input" placeholder="First Name" required>
                    <input type="text" id="signup-last-name" class="auth-input" placeholder="Last Name" required>
                    <input type="email" id="signup-email" class="auth-input" placeholder="Email Address" required>
                    <input type="password" id="signup-password" class="auth-input" placeholder="Password (minimum 6 characters)" required>
                    <p class="auth-error" id="signup-error"></p>
                    <button id="signup-btn" class="auth-btn">
                        <i class="fas fa-user-plus me-2"></i>Create Account
                    </button>
                </div>
                
                <!-- Guest Section -->
                <div id="guest-form" class="auth-form">
                    <div class="guest-section">
                        <div style="text-align: center; margin-bottom: 1.5rem;">
                            <i class="fas fa-user-clock" style="font-size: 2rem; color: #003366; margin-bottom: 1rem;"></i>
                        </div>
                        <p>Jump right in and play without creating an account. Note that your score won't be saved to our leaderboard.</p>
                        <button id="guest-btn" class="auth-btn">
                            <i class="fas fa-play me-2"></i>Play as Guest
                        </button>
                        <a class="guest-info-link" id="guest-info-link">
                            <i class="fas fa-info-circle me-1"></i>Why create an account?
                        </a>
                    </div>
                </div>
            </div>
            
            <div id="start-game-section" style="display: none;">
                <div id="play-as-info">
                    <div class="welcome-message">
                        <strong id="user-display-name">Guest</strong>
                        <p>Ready to test your knowledge of Minnesota history? You'll have 30 seconds per question, and your score decreases over time. Good luck!</p>
                    </div>
                    <button id="auth-start-game-btn" class="auth-btn">
                        <i class="fas fa-play me-2"></i>Start Game
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Guest Info Popup Enhanced -->
    <div id="guest-info-popup" class="popup">
        <div class="popup-content">
            <div style="text-align: center; margin-bottom: 1.5rem;">
                <i class="fas fa-trophy" style="font-size: 2.5rem; color: #003366;"></i>
            </div>
            <h3>Benefits of Creating an Account</h3>
            <p>While you can play as a guest, creating an account unlocks these features:</p>
            <ul>
                <li><strong>Leaderboard Rankings:</strong> Compare your scores with other players</li>
                <li><strong>Progress Tracking:</strong> See how you improve over time</li>
                <li><strong>Achievement System:</strong> Earn badges and unlock rewards</li>
                <li><strong>Score History:</strong> Review your past game performances</li>
            </ul>
            <p><strong>Privacy Promise:</strong> We never share your information and only use it to enhance your gaming experience.</p>
            <button id="close-guest-info" class="auth-btn" style="margin-top: 1.5rem;">
                <i class="fas fa-check me-2"></i>Got It
            </button>
        </div>
    </div>

    <!-- Feedback popup enhanced -->
    <div id="feedback-popup" class="popup">
        <div class="popup-content">
            <div id="question-number"></div>
            <div id="feedback-result"></div>
            <div id="question-score"></div>
            <div id="correct-answer"></div>
            <button id="next-question-btn">
                <i class="fas fa-arrow-right me-2"></i>Continue
            </button>
        </div>
    </div>

    <!-- Floating Action Button (FAB) to return to the blog's front page -->
    <a href="https://www.mnthen.com/trivia.html" class="mnthen-fab" aria-label="Return to Front Page">
        <i class="fas fa-home"></i>
        <span class="mnthen-fab-tooltip">Exit the Game</span>
    </a>

    <!-- End Game Modal - Enhanced -->
    <div id="game-end-popup" class="popup">
        <div class="popup-content">
            <div class="image-column d-none d-md-block">
                <img src="/images/index/trivia.jpg" alt="Minnesota History">
                <div id="final-score" class="final-score">
                    <i class="fas fa-trophy me-2"></i> Your Score: <strong>${totalScore}</strong>
                </div>
            </div>
            <div class="content-column">
                <div>
                    <h2><i class="fas fa-star me-2"></i>Game Complete!</h2>
                    <p>How did you do with Minnesota history? Challenge your friends to beat your score!</p>
                    
                    <div class="explore-section">
                        <h3><i class="fas fa-compass me-2"></i>Explore More</h3>
                        <a href="https://mnthen.com/mnthen_welcome.html" target="_blank" rel="noopener noreferrer">
                            <i class="fas fa-landmark"></i>Museum Without Walls
                        </a>
                        <a href="https://mnthen.com/blog.html" target="_blank" rel="noopener noreferrer">
                            <i class="fas fa-book-open"></i>Minnesota History Blog
                        </a>
                    </div>
                    
                    <div class="share-section">
                        <h4><i class="fas fa-share-alt me-2"></i>Share Your Score</h4>
                        <div class="share-buttons">
                            <button id="share-facebook" class="share-btn facebook-btn" title="Share on Facebook">
                                <i class="fab fa-facebook-f"></i>
                            </button>
                            <button id="share-twitter" class="share-btn twitter-btn" title="Share on Twitter">
                                <i class="fab fa-twitter"></i>
                            </button>
                            <button id="share-linkedin" class="share-btn linkedin-btn" title="Share on LinkedIn">
                                <i class="fab fa-linkedin-in"></i>
                            </button>
                        </div>
                        
                        <div class="navigation-links">
                            <a href="#" id="play-again-link">
                                <i class="fas fa-redo"></i> Play Again
                            </a>
                            <a href="https://www.mnthen.com/trivia.html">
                                <i class="fas fa-home"></i> Main Page
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="game-actions">
                    <button id="play-again-btn" class="play-again-btn">
                        <i class="fas fa-redo me-2"></i>Play Again
                    </button>
                    <button id="close-end-popup" class="exit-btn">
                        <i class="fas fa-times me-2"></i>Exit Game
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBDUAF3qJGhLYQJPHyWwY0JzonN5l8ERzE",
            authDomain: "mnthen-3151d.firebaseapp.com",
            projectId: "mnthen-3151d",
            storageBucket: "mnthen-3151d.appspot.com",
            messagingSenderId: "416231360428",
            appId: "1:416231360428:web:36f69cc231be2d84a8dc09",
            databaseURL: "https://mnthen-3151d-default-rtdb.firebaseio.com"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Game state variables
        let currentUser = null;
        let currentQuestionScore = 100;
        let totalScore = 0;
        let questionCount = 1;
        let totalQuestions = 10;
        let timer;
        let currentQuestion;
        let correctAnswer;
        let timeLeft = 30;
        let usedQuestions = new Set();
        let allQuestions = [];
        let gameStarted = false;

        // DOM elements
        const authStartGameBtn = document.getElementById('auth-start-game-btn');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const closeEndPopupBtn = document.getElementById('close-end-popup');
        const shareFacebookBtn = document.getElementById('share-facebook');
        const shareTwitterBtn = document.getElementById('share-twitter');
        const shareLinkedinBtn = document.getElementById('share-linkedin');
        const userDisplayName = document.getElementById('user-display-name');
        const guestInfoLink = document.getElementById('guest-info-link');
        const closeGuestInfoBtn = document.getElementById('close-guest-info');

        // Initialize the game when page loads
        window.onload = initializeGame;

        function initializeGame() {
            checkUserLoggedIn();
            fetchAllQuestions();
            
            // Hide timer and scores initially
            document.getElementById('timer').style.visibility = 'hidden';
            document.getElementById('current-score').style.visibility = 'hidden';
            document.getElementById('total-score').style.visibility = 'hidden';
            
            // Check if user is already logged in
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in, skip auth modal
                    currentUser = user;
                    showWelcomeMessage(user);
                } else {
                    // No user is signed in, show auth modal
                    showAuthModal();
                }
            });
            
            // Set up event listeners
            setupEventListeners();
        }

        function setupEventListeners() {
            // Game control buttons
            authStartGameBtn.addEventListener('click', startGame);
            nextQuestionBtn.addEventListener('click', handleNextQuestion);
            playAgainBtn.addEventListener('click', resetGame);
            closeEndPopupBtn.addEventListener('click', () => {
                document.getElementById('game-end-popup').classList.remove('show');
                window.location.href = 'https://www.mnthen.com/trivia.html';
            });
            
            // Social sharing buttons
            shareFacebookBtn.addEventListener('click', shareOnFacebook);
            shareTwitterBtn.addEventListener('click', shareOnTwitter);
            shareLinkedinBtn.addEventListener('click', shareOnLinkedIn);
            
            // Auth modal tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
                    
                    btn.classList.add('active');
                    document.getElementById(`${btn.dataset.tab}-form`).classList.add('active');
                });
            });
            
            // Auth form buttons
            document.getElementById('login-btn').addEventListener('click', handleLogin);
            document.getElementById('signup-btn').addEventListener('click', handleSignup);
            document.getElementById('guest-btn').addEventListener('click', handleGuest);
            
            // Password reset link
            document.getElementById('reset-password-link').addEventListener('click', handlePasswordReset);
            
            // Guest info link
            guestInfoLink.addEventListener('click', () => {
                document.getElementById('guest-info-popup').classList.add('show');
            });
            
            closeGuestInfoBtn.addEventListener('click', () => {
                document.getElementById('guest-info-popup').classList.remove('show');
            });

            // Add this to your setupEventListeners function
document.getElementById('play-again-link').addEventListener('click', (e) => {
    e.preventDefault();
    resetGame();
});
        }

        function switchToTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            document.querySelector(`.tab-btn[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-form`).classList.add('active');
        }

        function showAuthModal() {
            const modal = document.getElementById('auth-modal');
            modal.classList.add('show');
        }

        function showWelcomeMessage(user) {
            const displayName = user.displayName || user.email || 'Guest';
            userDisplayName.textContent = displayName;
            
            document.getElementById('auth-content').style.display = 'none';
            document.getElementById('start-game-section').style.display = 'block';
            document.getElementById('auth-modal').classList.add('show');
        }

        function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorElement = document.getElementById('login-error');
            
            if (!email || !password) {
                errorElement.textContent = 'Please enter both email and password';
                return;
            }
            
            firebase.auth().signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    showWelcomeMessage(currentUser);
                })
                .catch((error) => {
                    errorElement.textContent = error.message;
                });
        }

        function handlePasswordReset(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const errorElement = document.getElementById('login-error');
            
            if (!email) {
                errorElement.textContent = 'Please enter your email address first';
                return;
            }
            
            firebase.auth().sendPasswordResetEmail(email)
                .then(() => {
                    errorElement.textContent = '';
                    alert(`Password reset email sent to ${email}. Please check your inbox.`);
                })
                .catch((error) => {
                    errorElement.textContent = error.message;
                });
        }

        function handleSignup() {
            const firstName = document.getElementById('signup-first-name').value.trim();
            const lastName = document.getElementById('signup-last-name').value.trim();
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const errorElement = document.getElementById('signup-error');
            
            // Validation
            if (!firstName || !lastName) {
                errorElement.textContent = 'Please enter your first and last name';
                return;
            }
            
            if (!email) {
                errorElement.textContent = 'Please enter your email';
                return;
            }
            
            if (!password || password.length < 6) {
                errorElement.textContent = 'Password must be at least 6 characters';
                return;
            }
            
            firebase.auth().createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    
                    // Save additional user data to database
                    return database.ref('users/' + currentUser.uid).set({
                        firstName: firstName,
                        lastName: lastName,
                        email: email,
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    }).then(() => {
                        // Update display name in Firebase Auth
                        return currentUser.updateProfile({
                            displayName: `${firstName} ${lastName}`
                        });
                    });
                })
                .then(() => {
                    showWelcomeMessage(currentUser);
                })
                .catch((error) => {
                    errorElement.textContent = error.message;
                });
        }

        function handleGuest() {
            currentUser = null;
            userDisplayName.textContent = 'Guest';
            document.getElementById('auth-content').style.display = 'none';
            document.getElementById('start-game-section').style.display = 'block';
        }

        function checkUserLoggedIn() {
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    console.log("User is logged in:", user.uid);
                } else {
                    currentUser = null;
                    console.log("No user is logged in");
                }
            });
        }

        function fetchAllQuestions() {
            database.ref('mn_history_questions').once('value', (snapshot) => {
                snapshot.forEach((childSnapshot) => {
                    allQuestions.push(childSnapshot.val());
                });
            });
        }

        function startGame() {
            gameStarted = true;
            document.getElementById('auth-modal').classList.remove('show');
            document.getElementById('timer').style.visibility = 'visible';
            document.getElementById('current-score').style.visibility = 'visible';
            document.getElementById('total-score').style.visibility = 'visible';
            getNextQuestion();
        }

        function getNextQuestion() {
            if (!gameStarted) return;

            if (usedQuestions.size >= totalQuestions || questionCount > totalQuestions) {
                endGame();
                return;
            }

            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * allQuestions.length);
            } while (usedQuestions.has(randomIndex));

            usedQuestions.add(randomIndex);
            currentQuestion = allQuestions[randomIndex];
            correctAnswer = currentQuestion.correctAnswer;
            displayQuestion();
        }

        function displayQuestion() {
            document.getElementById('question').innerText = currentQuestion.text;
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';
            shuffleArray(currentQuestion.options).forEach((option, index) => {
                const optionBtn = document.createElement('button');
                optionBtn.classList.add('option-btn');
                optionBtn.textContent = option;
                optionBtn.addEventListener('click', () => handleOptionClick(option));
                optionsContainer.appendChild(optionBtn);
            });
            resetTimer();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function resetTimer() {
            if (!gameStarted) return;

            clearInterval(timer);
            currentQuestionScore = 100;
            timeLeft = 30;
            updateTimerDisplay();
            updateScoreDisplay();
            timer = setInterval(() => {
                timeLeft--;
                currentQuestionScore = Math.max(0, Math.floor(100 * (timeLeft / 30)));
                updateTimerDisplay();
                updateScoreDisplay();
                if (timeLeft % 6 === 0 && timeLeft > 0) {
                    eliminateIncorrectAnswer();
                }
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    handleTimeout();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            document.getElementById('timer').innerText = `Time: ${timeLeft}s`;
        }

        function updateScoreDisplay() {
            document.getElementById('current-score').innerText = `Question Score: ${currentQuestionScore}`;
            document.getElementById('total-score').innerText = `Game Score: ${totalScore}`;
        }

        function eliminateIncorrectAnswer() {
            const incorrectOptions = Array.from(document.querySelectorAll('.option-btn:not(.overlaid)'))
                .filter(option => option.textContent !== correctAnswer);
            if (incorrectOptions.length > 0) {
                const randomIndex = Math.floor(Math.random() * incorrectOptions.length);
                incorrectOptions[randomIndex].classList.add('overlaid');
            }
        }

        function handleTimeout() {
            if (!gameStarted) return;
            showFeedbackPopup(false, questionCount, "", correctAnswer);
        }

        function handleOptionClick(selectedOption) {
            if (!gameStarted) return;

            clearInterval(timer);
            const isCorrect = selectedOption === correctAnswer;

            if (isCorrect) {
                totalScore += currentQuestionScore;
            }

            document.querySelectorAll('.option-btn').forEach((btn) => {
                if (btn.textContent === selectedOption) {
                    btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                } else if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct');
                }
                btn.disabled = true;
            });

            updateScoreDisplay();
            showFeedbackPopup(isCorrect, questionCount, selectedOption, correctAnswer);
        }

        function showFeedbackPopup(isCorrect, currentQuestionIndex, userAnswer, correctAnswer) {
            const popup = document.getElementById('feedback-popup');
            const questionNumberElement = document.getElementById('question-number');
            const resultElement = document.getElementById('feedback-result');
            const correctAnswerElement = document.getElementById('correct-answer');
            const questionScoreElement = document.getElementById('question-score');

            resultElement.textContent = isCorrect ? 'Correct!' : 'Incorrect';
            resultElement.className = isCorrect ? 'text-success' : 'text-danger';

            if (isCorrect) {
                questionScoreElement.textContent = `Question Score: ${currentQuestionScore}`;
                questionScoreElement.style.display = 'block';
                correctAnswerElement.style.display = 'none';
            } else {
                correctAnswerElement.textContent = `Correct answer: ${correctAnswer}`;
                correctAnswerElement.style.display = 'block';
                questionScoreElement.style.display = 'none';
            }

            questionNumberElement.textContent = `Question ${currentQuestionIndex} of ${totalQuestions}`;
            popup.classList.add('show');
        }

        function handleNextQuestion() {
            document.getElementById('feedback-popup').classList.remove('show');
            questionCount++;
            if (questionCount > totalQuestions) {
                endGame();
            } else {
                getNextQuestion();
            }
        }

        function endGame() {
            gameStarted = false;
            const gameEndPopup = document.getElementById('game-end-popup');
            const finalScoreElement = document.getElementById('final-score');
            
            finalScoreElement.innerHTML = `<i class="fas fa-trophy me-2"></i> Your score: <strong>${totalScore}</strong>`;
            
            if (currentUser) {
                updateUserStats(totalScore);
            }
            
            clearInterval(timer);
            document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
            gameEndPopup.classList.add('show');
        }

        function updateUserStats(score) {
            if (!currentUser) return;

            const userRef = database.ref('users/' + currentUser.uid);

            userRef.transaction((currentData) => {
                if (currentData === null) {
                    return {
                        highScore: score,
                        gamesPlayed: 1,
                        allTimePoints: score
                    };
                }

                return {
                    ...currentData,
                    highScore: Math.max(currentData.highScore || 0, score),
                    gamesPlayed: (currentData.gamesPlayed || 0) + 1,
                    allTimePoints: (currentData.allTimePoints || 0) + score
                };
            });
        }

        function resetGame() {
            document.getElementById('game-end-popup').classList.remove('show');
            usedQuestions = new Set();
            totalScore = 0;
            questionCount = 1;
            updateScoreDisplay();
            gameStarted = true;
            getNextQuestion();
        }

        function shareOnFacebook() {
            const shareText = `I scored ${totalScore} points in the Minnesota Then History Trivia Game! Can you beat my score?`;
            const shareUrl = window.location.href;
            const facebookShareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}&quote=${encodeURIComponent(shareText)}`;
            window.open(facebookShareUrl, '_blank', 'width=600,height=400');
        }

        function shareOnTwitter() {
            const shareText = `I scored ${totalScore} points in the Minnesota Then History Trivia Game! Can you beat my score? @MNThen`;
            const shareUrl = window.location.href;
            const twitterShareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(shareUrl)}`;
            window.open(twitterShareUrl, '_blank', 'width=600,height=400');
        }

        function shareOnLinkedIn() {
            const shareTitle = "Minnesota Then History Trivia";
            const shareText = `I scored ${totalScore} points in the Minnesota Then History Trivia Game! Test your Minnesota history knowledge!`;
            const shareUrl = window.location.href;
            const linkedInShareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(shareUrl)}&title=${encodeURIComponent(shareTitle)}&summary=${encodeURIComponent(shareText)}`;
            window.open(linkedInShareUrl, '_blank', 'width=600,height=400');
        }
    </script>
</body>
</html>
